import{c as z,d as H,g as J}from"./chunk-BJQTH5Y4.js";import{a as A}from"./chunk-3VIQTQ4Q.js";import{a as B}from"./chunk-S6QTLLFU.js";import"./chunk-PSTD2D7J.js";import{a as D}from"./chunk-LK2RJHE2.js";import{a as W}from"./chunk-BPTCD5M7.js";import{a as j}from"./chunk-3DND4RW6.js";import"./chunk-7QJ2EETJ.js";import"./chunk-FKOEVO4B.js";import{a as R}from"./chunk-M7F2YWVM.js";import{a as V}from"./chunk-D5OLY3RM.js";import{C as N,b as x,c as w,e as I,f as M,g as E,h as _,j as G,k as P,l as T,n as U,o as O}from"./chunk-CQCVERZP.js";import"./chunk-4G3JCKZK.js";import"./chunk-4O3FVBGX.js";import{D as q,l as S,x as L,y as k}from"./chunk-QOJUQ6XD.js";import{$ as C,Bb as h,Cb as v,Hb as c,Ib as n,Jb as o,Kb as u,Wb as b,Za as l,ea as s,g as p,jb as F,jc as a}from"./chunk-A4JG42N6.js";var y=class r{auth=s(H);loginWithGoogle(){return p(this,null,function*(){let e=new z;try{return(yield J(this.auth,e)).user}catch(t){return t.code==="auth/cancelled-popup-request"||t.code==="auth/popup-closed-by-user"||console.error("Error en login:",t),null}})}static \u0275fac=function(t){return new(t||r)};static \u0275prov=C({token:r,factory:r.\u0275fac,providedIn:"root"})};function X(r,e){r&1&&(n(0,"p-message",16),a(1," Ingrese un mail. "),o())}function Y(r,e){r&1&&(n(0,"p-message",16),a(1,"Ingrese una contrase\xF1a."),o())}function Z(r,e){r&1&&u(0,"i",27)}var K=class r{loginService=s(V);userService=s(D);router=s(L);loginGoogleService=s(y);loggedUser;toastService=s(q);loginForm;onLogin=!1;constructor(){this.loginForm=new E({correo:new _("",[w.email,w.required]),contrasena:new _("",[w.required])})}ngOnInit(){this.loginService.getLoggedUser().subscribe(e=>{this.loggedUser=e}),this.loggedUser!=null&&this.router.navigate(["/principal"])}login(){return p(this,null,function*(){if(this.loginForm.markAllAsTouched(),this.onLogin=!0,!this.loginForm.valid){this.onLogin=!1;return}try{let e=yield this.loginService.login(this.loginForm.value);this.loginService.setLoggedUser(e.usuario),this.router.navigate(["/principal"])}catch{this.toastService.showToast({severity:"error",summary:"Credenciales inv\xE1lidas",detail:"Correo y/o contrase\xF1a incorrectas"})}finally{this.onLogin=!1}})}googleLogin(){return p(this,null,function*(){let e=yield this.loginGoogleService.loginWithGoogle();if(e)try{let t=yield this.userService.getUserInfo(e.email);if(!t){this.router.navigate(["/crear-perfil"],{state:{email:e.email,name:e.displayName,imageUrl:e.photoURL}});return}this.loginService.setLoggedUser(t),this.router.navigate(["/principal"])}catch(t){t.status===404&&this.router.navigate(["/crear-perfil"],{state:{email:e.email,name:e.displayName,imageUrl:e.photoURL}})}})}static \u0275fac=function(t){return new(t||r)};static \u0275cmp=F({type:r,selectors:[["app-login"]],decls:43,vars:10,consts:[[1,"row","me-0","justify-content-between","align-items-center"],[1,"col-auto"],["variant","text",3,"disabled"],[2,"color","transparent"],["id","screenWidth",1,"col","position-absolute","top-50","start-50","translate-middle"],[1,"container-fluid","align-items-center","justify-content-center"],["id","card",1,"col-lg-auto","m-auto"],["fluid","",1,"shadow-lg","px-4","flex"],[1,"text-center","mb-4","mt-4"],[1,"fw-bold","m-0"],[1,"text-sm","m-0","mt-1"],[1,"form-scroll-wrapper","justify-content-center","align-items-center"],[1,"me-2","mb-0","mt-2",3,"formGroup"],[1,"mb-4"],["for","correo",1,"form-label"],["id","correo","pInputText","","placeholder","tu-correo@ejemplo.com","type","email","formControlName","correo",1,"w-100","mt-1",3,"invalid"],["severity","error","size","small","variant","simple"],[1,"mt-4"],["for","contrasena",1,"form-label"],["id","contrasena","formControlName","contrasena","placeholder","Crea una contrase\xF1a","fluid","",1,"mt-1",3,"keyup.enter","feedback","toggleMask","invalid"],[1,"row","mt-1","justify-content-md-center"],[1,"col-md-auto","w-100","text-center"],["type","button","label","Registrarme","routerLink","/crear-usuario","link",""],["type","button","label","Olvidaste tu contrase\xF1a?","routerLink","/recuperar-contrasena","link",""],[1,"row","mb-4","mt-4","justify-content-md-center"],[1,"col-md-auto","w-100"],["styleClass","w-100",3,"onClick","disabled"],[1,"pi","pi-spin","pi-spinner"],["styleClass","w-100",3,"onClick"],["pButtonIcon","",1,"pi","pi-google"],["pButtonLabel",""]],template:function(t,i){if(t&1&&(n(0,"div",0)(1,"div",1)(2,"p-button",2)(3,"span",3),a(4,"-"),o()()(),n(5,"div",1),u(6,"app-theme-switcher"),o()(),n(7,"div",4)(8,"div",5)(9,"div",6)(10,"p-card",7)(11,"div",8)(12,"h1",9),a(13,"Iniciar sesi\xF3n"),o(),n(14,"p",10),a(15,"Ingresa con tu cuenta"),o()(),n(16,"div",11)(17,"form",12)(18,"div",13)(19,"label",14),a(20,"Correo electr\xF3nico"),o(),u(21,"input",15),h(22,X,2,0,"p-message",16),o(),n(23,"div",17)(24,"label",18),a(25,"Contrase\xF1a"),o(),n(26,"p-password",19),b("keyup.enter",function(){return i.login()}),o(),h(27,Y,2,0,"p-message",16),o()()(),n(28,"div",20)(29,"div",21),u(30,"p-button",22)(31,"p-button",23),o()(),n(32,"div",24)(33,"div",25)(34,"p-button",26),b("onClick",function(){return i.login()}),a(35," Iniciar sesi\xF3n "),h(36,Z,1,0,"i",27),o()()(),n(37,"div",24)(38,"div",25)(39,"p-button",28),b("onClick",function(){return i.googleLogin()}),u(40,"i",29),n(41,"span",30),a(42,"Ingresar con Google"),o()()()()()()()()),t&2){let m,d,g,f;l(2),c("disabled",!0),l(15),c("formGroup",i.loginForm),l(4),c("invalid",((m=i.loginForm.get("correo"))==null?null:m.invalid)&&((m=i.loginForm.get("correo"))==null?null:m.touched)),l(),v((d=i.loginForm.get("correo"))!=null&&d.invalid&&((d=i.loginForm.get("correo"))!=null&&d.touched)?22:-1),l(4),c("feedback",!1)("toggleMask",!0)("invalid",((g=i.loginForm.get("contrasena"))==null?null:g.invalid)&&((g=i.loginForm.get("contrasena"))==null?null:g.touched)),l(),v((f=i.loginForm.get("contrasena"))!=null&&f.invalid&&((f=i.loginForm.get("contrasena"))!=null&&f.touched)?27:-1),l(7),c("disabled",i.onLogin),l(2),v(i.onLogin?36:-1)}},dependencies:[S,O,G,x,I,M,P,T,U,j,W,A,N,R,k,B],styles:["@media (max-width: 1200px){#screenWidth[_ngcontent-%COMP%]{width:50%}}@media (max-width: 768px){#screenWidth[_ngcontent-%COMP%]{width:75%}}@media (max-width: 576px){#screenWidth[_ngcontent-%COMP%]{width:100%;min-width:unset}}#card[_ngcontent-%COMP%]{width:100%;max-height:90vh}.scroll-max[_ngcontent-%COMP%]{max-height:90vh;border:0px}.form-scroll-wrapper[_ngcontent-%COMP%]{max-height:30vh;overflow-y:auto;scrollbar-width:thin;scrollbar-color:rgba(0,0,0,.2) transparent}.form-scroll-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.form-scroll-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#0003;border-radius:10px}.form-scroll-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}"]})};export{K as Login};
