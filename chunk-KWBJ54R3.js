import{a as ae,b as oe,c as me,d as se,e as de}from"./chunk-TY7W5LNW.js";import{a as ge}from"./chunk-S6QTLLFU.js";import"./chunk-PSTD2D7J.js";import{b as ne}from"./chunk-OOHDZIPE.js";import{a as pe}from"./chunk-W5KZAQGJ.js";import"./chunk-2XCJVA3X.js";import"./chunk-PDTI4AWR.js";import"./chunk-6A5XL65D.js";import{a as fe}from"./chunk-LK2RJHE2.js";import{a as ce,c as ue}from"./chunk-ZXYQCOEA.js";import"./chunk-QD7ZASQF.js";import{a as le,b as re}from"./chunk-BPTCD5M7.js";import{a as te}from"./chunk-3DND4RW6.js";import"./chunk-7QJ2EETJ.js";import"./chunk-EL5SIMWJ.js";import"./chunk-FKOEVO4B.js";import{a as ie}from"./chunk-M7F2YWVM.js";import{a as ve}from"./chunk-D5OLY3RM.js";import{C as ee,b as Z,c as f,e as H,f as J,g as z,h as x,j as K,k as Q,l as W,n as X,o as Y}from"./chunk-CQCVERZP.js";import"./chunk-4G3JCKZK.js";import"./chunk-4O3FVBGX.js";import{D as _e,l as q,x as $}from"./chunk-QOJUQ6XD.js";import{Bb as v,Cb as h,Db as O,Ec as b,Fb as M,Gb as R,H as j,Hb as s,Ib as r,Jb as n,Kb as p,Rb as U,Va as k,Wb as _,Xb as C,Za as o,a as y,b as A,ea as T,g as L,ja as c,jb as G,jc as a,ka as u,kc as B,lc as I,pb as D}from"./chunk-A4JG42N6.js";function Ce(t,i){t&1&&(r(0,"p-message",24),a(1,"Ingrese un nombre v\xE1lido."),n())}function be(t,i){t&1&&(r(0,"p-message",24),a(1,"Ingrese un nombre de usuario v\xE1lido."),n())}function ye(t,i){if(t&1&&(r(0,"div",44)(1,"div",45),p(2,"img",46),n(),r(3,"div",47)(4,"div",48),a(5,"Imagen de perfil de google"),n(),p(6,"div",48),n()()),t&2){let l=C(2);o(2),s("src",l.imageUrl,k)}}function xe(t,i){t&1&&(r(0,"div",44)(1,"div",45),a(2,"Arrastra una imagen para subirla"),n()())}function we(t,i){if(t&1&&v(0,ye,7,1,"div",44)(1,xe,3,0,"div",44),t&2){let l=C();h(l.imageUrl!=""?0:1)}}function Fe(t,i){t&1&&(r(0,"div",44)(1,"div",45),a(2,"Arrastra una imagen para subirla"),n()())}function Se(t,i){if(t&1&&(r(0,"div",44)(1,"div",45),p(2,"img",49),n(),r(3,"div",47)(4,"div",48),a(5),n(),r(6,"div",48),a(7),n()()()),t&2){let l=i.$implicit,e=C(2);o(2),s("src",e.imageUrl?e.imageUrl:l.objectURL,k)("alt",l.name),o(3),I(" ",l.name," "),o(2),I("",l.size," bytes")}}function Pe(t,i){if(t&1&&(v(0,Fe,3,0,"div",44),M(1,Se,8,4,"div",44,O)),t&2){let l=C();h(l.uploadedFiles.length==0?0:-1),o(),R(l.uploadedFiles)}}function Ee(t,i){if(t&1){let l=U();r(0,"div",50)(1,"div",51)(2,"p-button",52),_("onClick",function(m){let d=c(l).chooseCallback;return u(d(m,d))}),n(),r(3,"p-button",53),_("onClick",function(){let m=c(l).clearCallback;return u(m())}),n()()()}if(t&2){let l=i.$implicit,e=C();o(2),s("rounded",!0)("outlined",!0),o(),s("rounded",!0)("outlined",!0)("disabled",!l||!e.imageUrl&&l.length===0)}}function Te(t,i){t&1&&(r(0,"p-message",24),a(1,"Seleccione al menos un rol."),n())}function Ie(t,i){t&1&&(r(0,"p-message",24),a(1,"Ingrese un nombre v\xE1lido."),n())}function ke(t,i){t&1&&(r(0,"p-message",24),a(1,"Ingrese un nombre de usuario v\xE1lido."),n())}function Ue(t,i){if(t&1&&(r(0,"div",44)(1,"div",45),p(2,"img",46),n(),r(3,"div",47)(4,"div",48),a(5,"Imagen de perfil de google"),n(),p(6,"div",48),n()()),t&2){let l=C(2);o(2),s("src",l.imageUrl,k)}}function Ve(t,i){t&1&&(r(0,"div",44)(1,"div",45),a(2,"Arrastra una imagen para subirla"),n()())}function Ne(t,i){if(t&1&&v(0,Ue,7,1,"div",44)(1,Ve,3,0,"div",44),t&2){let l=C();h(l.imageUrl!=""?0:1)}}function Ae(t,i){t&1&&(r(0,"div",44)(1,"div",45),a(2,"Arrastra una imagen para subirla"),n()())}function De(t,i){if(t&1&&(r(0,"div",44)(1,"div",45),p(2,"img",49),n(),r(3,"div",47)(4,"div",48),a(5),n(),r(6,"div",48),a(7),n()()()),t&2){let l=i.$implicit,e=C(2);o(2),s("src",e.imageUrl?e.imageUrl:l.objectURL,k)("alt",l.name),o(3),I(" ",l.name," "),o(2),I("",l.size," bytes")}}function Oe(t,i){if(t&1&&(v(0,Ae,3,0,"div",44),M(1,De,8,4,"div",44,O)),t&2){let l=C();h(l.uploadedFiles.length==0?0:-1),o(),R(l.uploadedFiles)}}function Me(t,i){if(t&1){let l=U();r(0,"div",50)(1,"div",51)(2,"p-button",52),_("onClick",function(m){let d=c(l).chooseCallback;return u(d(m,d))}),n(),r(3,"p-button",53),_("onClick",function(){let m=c(l).clearCallback;return u(m())}),n()()()}if(t&2){let l=i.$implicit,e=C();o(2),s("rounded",!0)("outlined",!0),o(),s("rounded",!0)("outlined",!0)("disabled",!l||!e.imageUrl&&l.length===0)}}function Re(t,i){t&1&&(r(0,"div",44)(1,"div",45),a(2,"Arrastra un PDF para subirlo"),n()())}function Le(t,i){t&1&&(r(0,"div",44)(1,"div",45),a(2,"Arrastra un PDF para subirlo"),n()())}function ze(t,i){if(t&1&&(r(0,"div",54)(1,"div",45),p(2,"i",55),n(),r(3,"div",47)(4,"div",48)(5,"strong"),a(6),n()(),r(7,"div",48),a(8),n()()()),t&2){let l=i.$implicit;o(6),B(l.name),o(2),I("",(l.size/1024/1024).toFixed(2)," MB")}}function je(t,i){if(t&1&&(v(0,Le,3,0,"div",44),M(1,ze,9,2,"div",54,O)),t&2){let l=C();h(l.uploadedPdfFiles.length==0?0:-1),o(),R(l.uploadedPdfFiles)}}function Ge(t,i){if(t&1){let l=U();r(0,"div",50)(1,"div",51)(2,"p-button",56),_("onClick",function(m){let d=c(l).chooseCallback;return u(d(m,d))}),n(),r(3,"p-button",53),_("onClick",function(){let m=c(l).clearCallback;return u(m())}),n()()()}if(t&2){let l=i.$implicit;o(2),s("rounded",!0)("outlined",!0),o(),s("rounded",!0)("outlined",!0)("disabled",!l||l.length===0)}}function Be(t,i){t&1&&p(0,"i",43)}var he=class t{router=T($);userService=T(fe);imageService=T(ue);loginService=T(ve);toastService=T(_e);userRolesOptions=[{label:"Donante",value:2},{label:"Donatario",value:3},{label:"Observador",value:4}];today=new Date;charityForm;userForm;typeSelected=1;uploadedFiles=[];uploadedPdfFiles=[];postUser=!1;image;imageUrl="";user;constructor(){let i=this.router.currentNavigation();this.user=i?.extras.state,this.userForm=new z({nombreApellido:new x(this.user?.name,[f.required,f.minLength(3),f.maxLength(25)]),alias:new x("",[f.minLength(3),f.maxLength(25),f.required]),fechaNacimiento:new x(""),roles:new x([],[f.required])}),this.charityForm=new z({nombreApellido:new x(this.user?.name,[f.required,f.minLength(3),f.maxLength(25)]),alias:new x("",[f.minLength(3),f.maxLength(25),f.required]),fechaNacimiento:new x("")})}ngOnInit(){return L(this,null,function*(){this.loginService.getLoggedUser().subscribe(i=>{i!=null&&this.router.navigate(["/principal"])}),(!this.user?.email||!this.user)&&this.router.navigate(["/login"]),this.user?.imageUrl&&(this.imageUrl=this.user.imageUrl)})}setImage(i){this.uploadedFiles.length==0?this.uploadedFiles.push(i.files[0]):this.uploadedFiles[0]=i.files[0];let l=new FileReader;l.onload=()=>{this.imageUrl=l.result},l.readAsDataURL(i.files[0])}clearImage(){this.uploadedFiles.length>0&&this.uploadedFiles.pop(),this.imageUrl=""}setPdfFile(i){this.uploadedPdfFiles.length==0?this.uploadedPdfFiles.push(i.files[0]):this.uploadedPdfFiles[0]=i.files[0]}clearPdfFile(){this.uploadedPdfFiles.length>0&&this.uploadedPdfFiles.pop()}changeType(i){switch(i){case 0:{this.typeSelected=1;break}case 1:{this.typeSelected=2;break}}}onSubmit(){return L(this,null,function*(){this.postUser=!0;let i;switch(i={correo:this.user.email},this.typeSelected){case 1:{i=A(y({},i),{tipoUsuario:"USUARIO"}),this.userForm.valid&&(i=y(y({},i),this.userForm.value));break}case 2:{i=A(y({},i),{tipoUsuario:"ORGANIZACION"}),this.charityForm.valid&&(i=y(y({},i),this.charityForm.value));break}}let l=!1;if(this.uploadedFiles[0]!=this.image&&this.uploadedFiles[0]){let e={image:this.uploadedFiles[0]};try{let m=yield this.imageService.uploadImage(e);this.imageUrl=m.data.url,this.image=this.uploadedFiles[0]}catch{l=!0}}this.imageUrl!=""&&(i=A(y({},i),{urlImagen:this.imageUrl})),i.fechaNacimiento==""&&delete i.fechaNacimiento;try{let e=yield this.userService.registerUser(i);this.toastService.showToast({severity:"success",summary:"Perfil creado!",detail:"Perfil creado correctamente"}),l&&this.toastService.showToast({severity:"warn",summary:"Error al guardar imagen",detail:"Puedes cargar nuevamente la imagen desde la edici\xF3n del perfil"}),this.typeSelected==2&&this.uploadedPdfFiles.length>0&&this.userService.postDocumentes(e.id,this.uploadedPdfFiles[0]).subscribe({next:()=>{this.toastService.showToast({severity:"success",summary:"Documentos subidos!",detail:"Documentos subidos correctamente"})},error:()=>{this.toastService.showToast({severity:"warn",summary:"Error al subir documentos",detail:"No pudimos subir los documentos, puedes intentar nuevamente desde la edici\xF3n del perfil"})}}),this.postUser=!1;let m=yield this.userService.getUserInfo(this.user.email);this.loginService.setLoggedUser(m),j(500).subscribe(()=>{this.router.navigateByUrl("/principal")})}catch{this.toastService.showToast({severity:"error",summary:"Error al crear perfil",detail:"Por favor intente nuevamente..."}),this.postUser=!1}})}static \u0275fac=function(l){return new(l||t)};static \u0275cmp=G({type:t,selectors:[["app-create-profile"]],decls:110,vars:29,consts:[["empty",""],["file",""],["header",""],[1,"row","me-0","justify-content-between","align-items-center"],[1,"col-auto"],["variant","text",3,"disabled"],[2,"color","transparent"],["id","screen",1,"col","position-absolute","top-50","start-50","translate-middle"],[1,"container-fluid","align-items-center","justify-content-center"],["id","card",1,"col-md-3","m-auto"],["scr","",1,"shadow-lg","px-4","flex"],[1,"text-center","mb-4","mt-4"],[1,"fw-bold","m-0"],[1,"text-sm","m-0","mt-1"],["value","0"],[1,"text-center"],["value","0",1,"w-50",3,"click"],["value","1",1,"w-50",3,"click"],[1,"form-scroll-wrapper","justify-content-center","align-items-center"],[1,"mb-0","mt-2","mx-1",3,"formGroup"],[1,"mb-4"],["for","nombreApellido",1,"form-label"],[2,"color","red"],["id","nombreApellido","pInputText","","fluid","","placeholder","Ingresa tu nombre y apellido","type","text","formControlName","nombreApellido",1,"w-100","mt-1",3,"invalid"],["severity","error","size","small","variant","simple"],["for","alias",1,"form-label"],["id","alias","pInputText","","fluid","","placeholder","Ingresa tu alias","type","text","formControlName","alias",1,"w-100","mt-1",3,"invalid"],["for","fechaNacimiento"],["id","fechaNacimiento","formControlName","fechaNacimiento","fluid","","inputId","icondisplay","appendTo","body","dateFormat","dd/mm/yy","placeholder","Selecciona tu fecha de nacimiento",1,"mt-1",3,"maxDate","iconDisplay","showIcon"],["for","userImage"],["name","userImage","id","userImage","styleClass","mt-1 w-100","accept",".jpg,.png,.jpeg","maxFileSize","1000000","mode","advanced",3,"onSelect","onClear","multiple","files"],["for","roles"],["fluid","","id","roles","formControlName","roles","optionLabel","label","optionValue","value",1,"mt-1",3,"options","multiple","invalid"],["value","1"],["id","nombreApellido","pInputText","","placeholder","Ingresa el nombre","type","text","formControlName","nombreApellido",1,"w-100","mt-1",3,"invalid"],["id","alias","pInputText","","placeholder","Ingresa tu alias","type","text","formControlName","alias",1,"w-100","mt-1",3,"invalid"],["id","fechaNacimiento","formControlName","fechaNacimiento","fluid","","inputId","icondisplay","appendTo","body","dateFormat","dd/mm/yy","placeholder","Selecciona la fecha de fundaci\xF3n",1,"mt-1",3,"maxDate","iconDisplay","showIcon"],["name","userImage","id","userImage","styleClass","mt-1","accept",".jpg,.png,.jpeg","maxFileSize","1000000","mode","advanced",3,"onSelect","onClear","multiple","files"],["for","pdfDocuments"],["name","pdfDocuments","id","pdfDocuments","styleClass","mt-1","accept",".pdf,application/pdf","maxFileSize","52428800","mode","advanced",3,"onSelect","onClear","multiple","files"],[1,"row","mt-2","mb-4","justify-content-md-center"],[1,"col-md-auto","w-100"],["fluid","",3,"onClick","disabled"],[1,"pi","pi-spin","pi-spinner"],[1,"row","justify-content-md-center"],[1,"col-md-auto"],["alt","google image","width","auto","height","75vh",2,"border-radius","0.5em",3,"src"],[1,"col"],[1,"row"],["width","auto","height","75vh",2,"border-radius","0.5em",3,"src","alt"],[1,"justify-between","items-center"],[1,"flex"],["icon","pi pi-images",1,"me-2",3,"onClick","rounded","outlined"],["icon","pi pi-times","severity","danger",3,"onClick","rounded","outlined","disabled"],[1,"row","justify-content-md-center","align-items-center"],[1,"pi","pi-file-pdf",2,"font-size","3rem","color","#e74c3c"],["icon","pi pi-file-pdf",1,"me-2",3,"onClick","rounded","outlined"]],template:function(l,e){if(l&1){let m=U();r(0,"div",3)(1,"div",4)(2,"p-button",5)(3,"span",6),a(4,"-"),n()()(),r(5,"div",4),p(6,"app-theme-switcher"),n()(),r(7,"div",7)(8,"div",8)(9,"div",9)(10,"p-card",10)(11,"div",11)(12,"h1",12),a(13,"Crea una perfil"),n(),r(14,"p",13),a(15,"Bienvenido. Crea un perfil para comenzar."),n()(),r(16,"p-tabs",14)(17,"p-tablist",15)(18,"p-tab",16),_("click",function(){return c(m),u(e.changeType(0))}),a(19,"Usuario"),n(),r(20,"p-tab",17),_("click",function(){return c(m),u(e.changeType(1))}),a(21,"Organizaci\xF3n"),n()(),r(22,"p-tabpanels")(23,"p-tabpanel",14)(24,"div",18)(25,"form",19)(26,"div",20)(27,"label",21),a(28,"Nombre y apellido"),r(29,"span",22),a(30,"\u2002*"),n()(),p(31,"input",23),v(32,Ce,2,0,"p-message",24),n(),r(33,"div",20)(34,"label",25),a(35,"Nombre usuario"),r(36,"span",22),a(37,"\u2002*"),n()(),p(38,"input",26),v(39,be,2,0,"p-message",24),n(),r(40,"div",20)(41,"label",27),a(42,"Fecha de nacimiento"),n(),p(43,"p-datepicker",28),n(),r(44,"div",20)(45,"label",29),a(46,"Foto de perfil"),n(),r(47,"p-fileupload",30),_("onSelect",function(g){return c(m),u(e.setImage(g))})("onClear",function(){return c(m),u(e.clearImage())}),D(48,we,2,1,"ng-template",null,0,b)(50,Pe,3,1,"ng-template",null,1,b)(52,Ee,4,5,"ng-template",null,2,b),n()(),r(54,"div")(55,"label",31),a(56,"Selecciona los roles que desea tener"),r(57,"span",22),a(58,"\u2002*"),n()(),r(59,"div",15),p(60,"p-selectbutton",32),v(61,Te,2,0,"p-message",24),n()()()()(),r(62,"p-tabpanel",33)(63,"div",18)(64,"form",19)(65,"div",20)(66,"label",21),a(67,"Nombre de la organizaci\xF3n"),r(68,"span",22),a(69,"\u2002*"),n()(),p(70,"input",34),v(71,Ie,2,0,"p-message",24),n(),r(72,"div",20)(73,"label",25),a(74,"Nombre usuario"),r(75,"span",22),a(76,"\u2002*"),n()(),p(77,"input",35),v(78,ke,2,0,"p-message",24),n(),r(79,"div",20)(80,"label",27),a(81,"Fecha de fundaci\xF3n"),n(),p(82,"p-datepicker",36),n(),r(83,"div",20)(84,"label",29),a(85,"Logo"),n(),r(86,"p-fileupload",37),_("onSelect",function(g){return c(m),u(e.setImage(g))})("onClear",function(){return c(m),u(e.clearImage())}),D(87,Ne,2,1,"ng-template",null,0,b)(89,Oe,3,1,"ng-template",null,1,b)(91,Me,4,5,"ng-template",null,2,b),n()(),r(93,"div")(94,"label",38),a(95,"Documentos de respaldo (PDF)"),r(96,"span",22),a(97,"\u2002*"),n()(),r(98,"p-fileupload",39),_("onSelect",function(g){return c(m),u(e.setPdfFile(g))})("onClear",function(){return c(m),u(e.clearPdfFile())}),D(99,Re,3,0,"ng-template",null,0,b)(101,je,3,1,"ng-template",null,1,b)(103,Ge,4,5,"ng-template",null,2,b),n()()()()()()(),r(105,"div",40)(106,"div",41)(107,"p-button",42),_("onClick",function(){return c(m),u(e.onSubmit())}),a(108," Crear perfil "),v(109,Be,1,0,"i",43),n()()()()()()()}if(l&2){let m,d,g,w,V,N,F,S,P,E;o(2),s("disabled",!0),o(23),s("formGroup",e.userForm),o(6),s("invalid",((m=e.userForm.get("nombreApellido"))==null?null:m.invalid)&&((m=e.userForm.get("nombreApellido"))==null?null:m.touched)&&((m=e.userForm.get("nombreApellido"))==null?null:m.dirty)),o(),h((d=e.userForm.get("nombreApellido"))!=null&&d.invalid&&((d=e.userForm.get("nombreApellido"))!=null&&d.touched)&&((d=e.userForm.get("nombreApellido"))!=null&&d.dirty)?32:-1),o(6),s("invalid",((g=e.userForm.get("alias"))==null?null:g.invalid)&&((g=e.userForm.get("alias"))==null?null:g.touched)&&((g=e.userForm.get("alias"))==null?null:g.dirty)),o(),h((w=e.userForm.get("alias"))!=null&&w.invalid&&((w=e.userForm.get("alias"))!=null&&w.touched)&&((w=e.userForm.get("alias"))!=null&&w.dirty)?39:-1),o(4),s("maxDate",e.today)("iconDisplay","input")("showIcon",!0),o(4),s("multiple",!1)("files",e.uploadedFiles),o(13),s("options",e.userRolesOptions)("multiple",!0)("invalid",((V=e.userForm.get("roles"))==null?null:V.invalid)&&((V=e.userForm.get("roles"))==null?null:V.dirty)),o(),h((N=e.userForm.get("roles"))!=null&&N.invalid&&((N=e.userForm.get("roles"))!=null&&N.dirty)?61:-1),o(3),s("formGroup",e.charityForm),o(6),s("invalid",((F=e.charityForm.get("nombreApellido"))==null?null:F.invalid)&&((F=e.charityForm.get("nombreApellido"))==null?null:F.touched)&&((F=e.charityForm.get("nombreApellido"))==null?null:F.dirty)),o(),h((S=e.charityForm.get("nombreApellido"))!=null&&S.invalid&&((S=e.charityForm.get("nombreApellido"))!=null&&S.touched)&&((S=e.charityForm.get("nombreApellido"))!=null&&S.dirty)?71:-1),o(6),s("invalid",((P=e.charityForm.get("alias"))==null?null:P.invalid)&&((P=e.charityForm.get("alias"))==null?null:P.touched)&&((P=e.charityForm.get("alias"))==null?null:P.dirty)),o(),h((E=e.charityForm.get("alias"))!=null&&E.invalid&&((E=e.charityForm.get("alias"))!=null&&E.touched)&&((E=e.charityForm.get("alias"))!=null&&E.dirty)?78:-1),o(4),s("maxDate",e.today)("iconDisplay","input")("showIcon",!0),o(4),s("multiple",!1)("files",e.uploadedFiles),o(12),s("multiple",!1)("files",e.uploadedPdfFiles),o(9),s("disabled",e.typeSelected==1&&e.userForm.invalid||e.typeSelected==2&&(e.charityForm.invalid||!e.uploadedPdfFiles.length)||e.postUser),o(2),h(e.postUser?109:-1)}},dependencies:[Y,K,Z,H,J,Q,W,X,q,ge,te,ee,ie,ne,re,le,de,oe,ae,se,me,pe,ce],styles:["@media (max-width: 1200px){#screen[_ngcontent-%COMP%]{width:45%!important}}@media (max-width: 768px){#screen[_ngcontent-%COMP%]{width:75%!important}}@media (max-width: 576px){#screen[_ngcontent-%COMP%]{width:100%!important}}#screen[_ngcontent-%COMP%]{width:40%}#card[_ngcontent-%COMP%]{width:100%;max-height:90vh}.scroll-max[_ngcontent-%COMP%]{max-height:90vh;border:0px}.form-scroll-wrapper[_ngcontent-%COMP%]{max-height:35vh;overflow-y:auto;scrollbar-width:thin;scrollbar-color:rgba(0,0,0,.2) transparent}.form-scroll-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar{width:4px}.form-scroll-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#0003;border-radius:10px}.form-scroll-wrapper[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:transparent}[_nghost-%COMP%]     .p-message-content{height:auto!important}.limited-text[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}  .p-fileupload-file-badge{display:none!important}  .p-progressbar{display:none!important}  .p-fileupload-file-actions{display:none!important}"]})};export{he as CreateProfile};
