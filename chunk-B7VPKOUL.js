import{a as re}from"./chunk-LNBGOKAC.js";import{a as oe,b as ae}from"./chunk-4RUQD4IH.js";import"./chunk-IUTEPSDB.js";import{a as le}from"./chunk-A6NZNUHX.js";import{a as se}from"./chunk-SGMXIVTQ.js";import"./chunk-RSHBZTWH.js";import{a as D,b as $,c as j,d as V,e as B,f as H}from"./chunk-TY7W5LNW.js";import{a as k,b as z}from"./chunk-WNWYPXJT.js";import{a as J,b as K,c as Q,d as W,e as X}from"./chunk-MJPKGVT2.js";import{a as te}from"./chunk-AVGQIJ4R.js";import"./chunk-J7ZDMBSI.js";import{b as ie}from"./chunk-R4M2EAJZ.js";import{a as Y,b as ee}from"./chunk-CYTZBTDE.js";import"./chunk-2XCJVA3X.js";import"./chunk-PDTI4AWR.js";import"./chunk-6A5XL65D.js";import"./chunk-7AHVG7ZA.js";import"./chunk-BOTTEXY6.js";import"./chunk-FQGKTMLL.js";import"./chunk-DTLGCBUS.js";import"./chunk-7QH3DEV4.js";import{a as ne}from"./chunk-DW6VR7TT.js";import"./chunk-7QJ2EETJ.js";import"./chunk-EL5SIMWJ.js";import"./chunk-FKOEVO4B.js";import"./chunk-M7F2YWVM.js";import{a as Z}from"./chunk-D5OLY3RM.js";import{C as N,D as A,u as U,v as O}from"./chunk-CQCVERZP.js";import"./chunk-4G3JCKZK.js";import"./chunk-4O3FVBGX.js";import{D as G,x as I}from"./chunk-QOJUQ6XD.js";import{Bb as m,Cb as p,Db as y,Ec as S,Fb as b,Gb as q,Hb as _,Ib as n,Jb as a,Kb as u,Rb as w,Wb as g,Xb as d,Za as r,ea as f,hc as M,ja as x,jb as L,jc as s,ka as C,kc as P,la as E,lc as v,ma as T,pb as h,rc as F}from"./chunk-A4JG42N6.js";var ce=()=>({severity:"contrast",raised:!0,rounded:!0});function me(e,i){e&1&&(n(0,"p-tab",10),s(1,"Mis solicitudes"),a())}function pe(e,i){e&1&&(n(0,"p-tab",11),s(1,"Solicitudes de mis productos"),a())}function ue(e,i){e&1&&(n(0,"div",13),E(),n(1,"svg",15)(2,"metadata"),s(3,"Created by potrace 1.10, written by Peter Selinger 2001-2011"),a(),n(4,"g",16),u(5,"path",17)(6,"path",18)(7,"path",19)(8,"path",20)(9,"path",21)(10,"path",22),a()(),T(),n(11,"h2"),s(12,"No hay solicitudes"),a(),n(13,"span"),s(14,"No solicitaste ning\xFAn producto todav\xEDa..."),a()())}function _e(e,i){e&1&&u(0,"p-divider",23)}function fe(e,i){if(e&1&&u(0,"p-avatar",27),e&2){let t=d(2).$implicit;_("image",t.producto.urlImagen)}}function ve(e,i){e&1&&u(0,"p-avatar",28)}function ge(e,i){if(e&1){let t=w();m(0,_e,1,0,"p-divider",23),n(1,"div",24)(2,"div",25)(3,"div",8)(4,"div",25)(5,"div",26),m(6,fe,1,1,"p-avatar",27)(7,ve,1,0,"p-avatar",28),a()(),n(8,"div",29)(9,"div",30)(10,"div")(11,"div",31),s(12),a(),n(13,"span",32),s(14),a()()(),n(15,"div",33)(16,"div",34),s(17,"Fecha de solicitud"),a(),n(18,"span",32),s(19),a()(),n(20,"div",33)(21,"div",35)(22,"div")(23,"div",36),s(24,"Mensaje"),a(),n(25,"span",32),s(26),a()()()()()()(),n(27,"div",37)(28,"div")(29,"p-button",38),g("click",function(){x(t);let l=d().$implicit,c=d(4);return C(c.deleteRequest(l))}),a()()()()}if(e&2){let t=d(),o=t.$implicit,l=t.$index;p(l!=0?0:-1),r(6),p(o.producto.urlImagen?6:7),r(6),v(" ",o.producto.nombre," "),r(2),v(" ",o.producto.categoria.nombre," "),r(5),v(" ",o.fechaSolicitud," "),r(7),v(" ",o.mensaje," "),r(3),_("disabled",o.estadoSolicitud!="PENDIENTE")}}function xe(e,i){e&1&&m(0,ge,30,7),e&2&&p(0)}function Ce(e,i){if(e&1&&(n(0,"div"),b(1,xe,1,1,null,null,y),a()),e&2){let t=i.$implicit;r(),q(t)}}function he(e,i){if(e&1&&(n(0,"p-dataview",14,0),h(2,Ce,3,0,"ng-template",null,1,S),a()),e&2){let t=d(2);_("value",t.myRequests)}}function ye(e,i){if(e&1&&(n(0,"p-tabpanel",10),m(1,ue,15,0,"div",13)(2,he,4,1,"p-dataview",14),a()),e&2){let t=d();r(),p(t.myRequests.length==0?1:2)}}function be(e,i){e&1&&(n(0,"div",13),E(),n(1,"svg",15)(2,"metadata"),s(3,"Created by potrace 1.10, written by Peter Selinger 2001-2011"),a(),n(4,"g",16),u(5,"path",17)(6,"path",18)(7,"path",19)(8,"path",20)(9,"path",21)(10,"path",22),a()(),T(),n(11,"h2"),s(12,"No hay solicitudes"),a(),n(13,"span"),s(14,"No te solicitaron ning\xFAn producto todav\xEDa..."),a()())}function qe(e,i){e&1&&u(0,"i",44)}function Se(e,i){e&1&&u(0,"i",45)}function Re(e,i){if(e&1&&m(0,qe,1,0,"i",44)(1,Se,1,0,"i",45),e&2){let t=i.active;p(t?0:1)}}function Ee(e,i){e&1&&u(0,"p-divider")}function Te(e,i){if(e&1&&u(0,"p-avatar",47),e&2){let t=d(2).$implicit;_("image",t.fromUser==null?null:t.fromUser.urlImagen)}}function we(e,i){e&1&&u(0,"p-avatar",48)}function Me(e,i){if(e&1){let t=w();m(0,Ee,1,0,"p-divider"),n(1,"div",46)(2,"div",25)(3,"div",8)(4,"div",25)(5,"div",26),m(6,Te,1,1,"p-avatar",47)(7,we,1,0,"p-avatar",48),a()(),n(8,"div",29)(9,"div",30)(10,"div")(11,"div",31),s(12),a(),n(13,"span",32),s(14),a()()(),n(15,"div",33)(16,"div",34),s(17,"Fecha de solicitud"),a(),n(18,"span",32),s(19),a()(),n(20,"div",33)(21,"div",35)(22,"div")(23,"div",36),s(24,"Mensaje"),a(),n(25,"span",32),s(26),a()()()()()()(),n(27,"div",37)(28,"div")(29,"p-button",49),g("click",function(){x(t);let l=d().$implicit,c=d(2).$implicit,R=d(3);return C(R.aceptRequest(l,c.product))}),a(),n(30,"p-button",50),g("click",function(){x(t);let l=d().$implicit,c=d(5);return C(c.declineRequest(l))}),a()()()()}if(e&2){let t=d(),o=t.$implicit,l=t.$index;p(l!=0?0:-1),r(6),p(o.fromUser!=null&&o.fromUser.urlImagen?6:7),r(6),v(" ",o.fromUser==null?null:o.fromUser.nombreApellido," "),r(2),v(" ",o.fromUser==null?null:o.fromUser.alias," "),r(5),v(" ",o.requestDate," "),r(7),v(" ",o.message," "),r(3),_("disabled",o.requestState!="PENDIENTE"),r(),_("disabled",o.requestState!="PENDIENTE")}}function Le(e,i){e&1&&m(0,Me,31,8),e&2&&p(0)}function Pe(e,i){if(e&1&&(n(0,"div"),b(1,Le,1,1,null,null,y),a()),e&2){let t=i.$implicit;r(),q(t)}}function Fe(e,i){if(e&1&&(n(0,"p-accordion-panel",9)(1,"p-accordion-header"),h(2,Re,2,1,"ng-template",null,2,S),n(4,"span",40),u(5,"p-avatar",41),n(6,"span",42),s(7),a(),u(8,"p-badge",43),a()(),n(9,"p-accordion-content")(10,"p-dataview",9,0),h(12,Pe,3,0,"ng-template",null,1,S),a()()()),e&2){let t=i.$implicit,o=i.$index,l=d(3);M(o==l.requestOfProducts.length-1?"border: 0":""),_("value",t),r(5),_("image",t.product.urlImagen),r(2),P(t.product.nombre),r(),_("value",t.requests.length),r(),M(o==l.requestOfProducts.length-1?"border-radius: 0 0 var(--p-content-border-radius) var(--p-content-border-radius)":""),r(),_("value",t.requests)}}function Ie(e,i){if(e&1&&(n(0,"p-accordion",10),b(1,Fe,14,9,"p-accordion-panel",39,y),a()),e&2){let t=d(2);r(),q(t.requestOfProducts)}}function Ue(e,i){if(e&1&&(n(0,"p-tabpanel",11),m(1,be,15,0,"div",13)(2,Ie,3,0,"p-accordion",10),a()),e&2){let t=d();r(),p(t.requestOfProducts.length==0?1:2)}}var de=class e{loginService=f(Z);requestService=f(re);notificationService=f(ie);roomService=f(se);messagesService=f(le);router=f(I);toasts=f(G);permissionsService=f(ne);logedUser;defaultTab="0";myRequests=[];requestOfProducts=[];canSeeMyRequests=!1;canSeeRequestsOfMyProducts=!1;ngOnInit(){this.loginService.getLoggedUser().subscribe(i=>{if(this.logedUser=i,i==null){this.router.navigate(["/login"]);return}if(!this.permissionsService.canAccessRoute(i,this.router.url)){this.router.navigate(["/principal"]);return}this.logedUser.roles.some(t=>t.id===3)&&(this.canSeeMyRequests=!0),this.logedUser.roles.some(t=>t.id===2)&&(this.canSeeRequestsOfMyProducts=!0,this.defaultTab=this.canSeeMyRequests?"0":"1"),this.getMyRequests(),this.getRequestsOfMyProducts(),history.state.goMyRequestsTab&&(this.defaultTab="1")})}goHome(){this.router.navigate(["/principal"])}getMyRequests(){this.requestService.getRequestsFrom(this.logedUser?.id,null).subscribe({next:i=>{this.myRequests=i},error:()=>{this.toasts.showToast({severity:"error",summary:"Error al obtener tus solicitudes",detail:"No pudimos obtener tus solicitudes, intente nuevamente..."})}})}getRequestsOfMyProducts(){this.requestService.getRequestsFrom(null,this.logedUser?.id).subscribe({next:i=>{this.requestOfProducts=i.reduce((t,o)=>{let l=o.producto.id,c=t.find(R=>R.product.id===l);return c||(c={product:o.producto,requests:[]},t.push(c)),c.requests.push({id:o.id,fromUser:o.solicitante,toUser:o.donador,message:o.mensaje,requestDate:o.fechaSolicitud,requestState:o.estadoSolicitud}),t},[])},error:()=>{this.toasts.showToast({severity:"error",summary:"Error al obtener las solicitudes de tus productos",detail:"No pudimos obtener las solicitudes de tus productos, intente nuevamente..."})}})}deleteRequest(i){this.requestService.deleteRequest(i.id).subscribe({next:()=>{this.toasts.showToast({severity:"success",summary:"Solicitud eliminada",detail:"La solicitud ha sido eliminada correctamente."}),this.myRequests=this.myRequests.filter(t=>t.id!==i.id)},error:()=>{this.toasts.showToast({severity:"error",summary:"Error al eliminar la solicitud",detail:"No pudimos eliminar la solicitud, intente nuevamente..."})}})}aceptRequest(i,t){this.requestService.updateRequestState(i.id,"ACEPTADA").subscribe({next:()=>{this.toasts.showToast({severity:"success",summary:"Solicitud aceptada",detail:"La solicitud ha sido aceptada correctamente."}),this.getRequestsOfMyProducts(),this.notificationService.sendNotification({deUsuario:i.toUser.id,ausuario:i.fromUser.id,tipoNotificacion:2,mensaje:`${this.logedUser.alias} acept\xF3 tu solicitud para el producto ${t.nombre}, dir\xEDgite a los chats para coordinar la entrega.`}).subscribe({next:()=>{}});try{this.roomService.getDonorRooms(this.logedUser?.id).subscribe({next:o=>{let l=o.find(c=>c?.solicitud?.id===i.id||c?.solicitud?.producto?.id===t.id&&c?.solicitud?.solicitante?.id===i.fromUser.id);if(l&&i.message){let c={mensaje:i.message,idUsuario:i.fromUser.id,idSala:l.id};this.messagesService.sendMessage(c).subscribe({next:()=>{},error:()=>{}})}},error:()=>{}})}catch{}},error:()=>{this.toasts.showToast({severity:"error",summary:"Error al aceptar la solicitud",detail:"No pudimos aceptar la solicitud, intente nuevamnte..."})}})}declineRequest(i){this.requestService.updateRequestState(i.id,"RECHAZADA").subscribe({next:()=>{this.toasts.showToast({severity:"success",summary:"Solicitud rechazada",detail:"La solicitud ha sido rechazada correctamente."}),this.getRequestsOfMyProducts()},error:()=>{this.toasts.showToast({severity:"error",summary:"Error al rechazar la solicitud",detail:"No pudimos rechazar la solicitud, intente nuevamnte..."})}})}static \u0275fac=function(t){return new(t||e)};static \u0275cmp=L({type:e,selectors:[["app-requests-list"]],decls:15,vars:8,consts:[["dv",""],["list",""],["toggleicon",""],[1,"main-container","container-fluid"],[1,"col-auto","justify-content-center","align-content-center","h-100"],[1,"d-flex","row","mb-2"],[1,"d-flex","my-2","align-items-center","mb-4"],[1,"pi","pi-chevron-left","me-3","go-back-buttom",3,"click"],[1,"row"],[3,"value"],["value","0"],["value","1"],["target","parent","icon","pi pi-arrow-up",3,"threshold","buttonProps"],[1,"row","py-3","justify-content-center","text-center"],[1,"my-requests",3,"value"],["version","1.0","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 420 500","id","no-data-logo","width","150","height","150"],["transform","translate(0.000000,512.000000) scale(0.100000,-0.100000)","stroke","none"],["d","M2885 5114 c-220 -31 -373 -77 -528 -156 -407 -209 -693 -590 -784 -1045 -24 -123 -24 -413 0 -536 49 -244 180 -520 323 -680 19 -20 34 -40 34 -44 0 -4 -59 -67 -132 -140 l-131 -131 -39 26 c-47 30 -127 40 -184 22 -32 -10 -169 -142 -711 -683 -474 -473 -679 -685 -698 -719 -60 -110 -41 -234 49 -324 90 -90 214 -109 324 -49 34 19 246 224 719 698 541 542 673 679 683 711 18 57 8 137 -22 184 l-26 39 133 133 c124 123 135 132 153 119 10 -8 59 -45 108 -82 158 -120 380 -217 604 -264 118 -24 409 -24 533 0 607 121 1071 588 1183 1192 26 137 26 383 0 520 -111 597 -574 1069 -1162 1185 -104 21 -355 35 -429 24z m385 -149 c278 -54 496 -170 700 -375 206 -205 320 -419 376 -705 27 -134 24 -367 -5 -505 -74 -350 -283 -660 -573 -851 -114 -75 -157 -97 -278 -142 -159 -59 -280 -80 -465 -80 -182 0 -299 19 -458 77 -117 43 -169 69 -285 145 -295 194 -510 519 -578 871 -24 127 -24 361 0 485 35 183 107 360 211 515 57 85 200 238 278 298 198 153 434 251 679 282 98 12 294 5 398 -15z m-1653 -2728 c95 -95 95 -106 6 -198 l-67 -70 -103 103 -104 103 70 68 c92 90 102 89 198 -6z m-709 -915 c-443 -443 -560 -555 -591 -564 -99 -30 -201 65 -182 170 6 32 77 107 563 594 l557 558 102 -102 103 -103 -552 -553z"],["d","M2915 4833 c-130 -11 -309 -64 -438 -130 -60 -30 -160 -96 -188 -124 -25 -25 -24 -64 1 -89 28 -28 59 -25 106 9 254 187 592 251 899 170 369 -96 660 -387 754 -754 80 -310 17 -645 -170 -899 -34 -47 -37 -78 -9 -106 25 -25 64 -26 89 -1 53 53 129 185 181 315 75 189 96 456 51 664 -108 509 -520 882 -1040 942 -83 10 -153 10 -236 3z"],["d","M2102 4393 c-18 -7 -103 -135 -144 -218 -199 -399 -155 -890 113 -1245 347 -459 973 -608 1484 -352 90 45 211 126 219 147 11 30 6 55 -14 75 -27 27 -59 25 -101 -6 -354 -265 -852 -277 -1224 -29 -484 322 -614 983 -290 1470 30 46 55 93 55 104 0 42 -53 72 -98 54z"],["d","M2487 4042 c-33 -36 -22 -73 38 -132 l55 -54 -55 -56 c-63 -63 -73 -106 -33 -134 37 -26 60 -19 120 41 l57 57 60 -57 c65 -62 97 -71 131 -37 34 34 25 66 -37 131 l-57 60 53 51 c59 60 70 88 47 123 -12 18 -25 25 -49 25 -26 0 -43 -11 -87 -55 l-54 -54 -57 54 c-63 60 -102 71 -132 37z"],["d","M3186 4038 c-26 -37 -19 -60 41 -120 l57 -57 -57 -60 c-62 -65 -71 -97 -37 -131 34 -34 66 -25 130 36 l58 56 59 -56 c32 -31 67 -56 78 -56 36 0 65 28 65 63 0 26 -11 43 -55 87 l-55 54 55 56 c60 61 72 102 37 133 -34 31 -69 21 -131 -38 l-57 -54 -54 54 c-62 63 -106 74 -134 33z"],["d","M2923 3350 c-107 -20 -259 -97 -298 -153 -20 -29 -19 -70 3 -90 30 -27 70 -21 115 18 56 48 113 74 205 92 71 14 86 14 156 0 92 -19 147 -44 203 -92 65 -55 133 -40 133 29 0 53 -126 144 -250 180 -68 20 -199 28 -267 16z"],[1,"m-0"],[1,"d-lg-flex","flex-row","justify-content-between","p-4"],[1,"col-auto"],[1,"align-content-center","mt-1"],["size","xlarge","shape","circle",3,"image"],["size","xlarge","shape","circle","icon","pi pi-gift"],[1,"col"],[1,"flex-md-column","justify-content-evenly","align-items-start","gap-2"],[1,"fw-medium","fs-5"],[1,"fw-medium","text-secondary","small"],[1,"d-flex","flex-row","mt-2"],[1,"fw-medium","fs-6","me-2"],[1,"d-flex","flex-row","flex-md-column","justify-content-evenly","align-items-start","gap-2"],[1,"fw-medium","fs-6"],[1,"d-grid","col-lg-auto","mt-2","align-self-center","justify-content-center","align-items-center"],["icon","pi pi-times","label","Eliminar","severity","danger",1,"flex-grow-1","flex-md-grow-0","text-nowrap",3,"click","disabled"],[3,"value","style"],[1,"d-flex","align-items-center","gap-2","w-full"],["shape","circle","size","xlarge",3,"image"],[1,"font-bold"],[1,"ml-auto","mr-2",3,"value"],[1,"pi","pi-minus"],[1,"pi","pi-plus"],[1,"d-lg-flex","flex-row","justify-content-between"],["size","large","shape","circle",3,"image"],["size","large","shape","circle","icon","pi pi-user"],["icon","pi pi-thumbs-up","label","Aceptar",1,"flex-grow-1","flex-md-grow-0","text-nowrap","me-2",3,"click","disabled"],["icon","pi pi-times","label","Rechazar","severity","danger",1,"flex-grow-1","flex-md-grow-0","text-nowrap",3,"click","disabled"]],template:function(t,o){t&1&&(n(0,"div",3)(1,"div",4)(2,"div",5)(3,"h1",6)(4,"i",7),g("click",function(){return o.goHome()}),a(),s(5," Solicitudes "),a()(),n(6,"div",8)(7,"p-tabs",9)(8,"p-tablist"),m(9,me,2,0,"p-tab",10),m(10,pe,2,0,"p-tab",11),a(),n(11,"p-tabpanels"),m(12,ye,3,1,"p-tabpanel",10),m(13,Ue,3,1,"p-tabpanel",11),a()()()(),u(14,"p-scrolltop",12),a()),t&2&&(r(7),_("value",o.defaultTab),r(2),p(o.canSeeMyRequests?9:-1),r(),p(o.canSeeRequestsOfMyProducts?10:-1),r(2),p(o.canSeeMyRequests?12:-1),r(),p(o.canSeeRequestsOfMyProducts?13:-1),r(),_("threshold",100)("buttonProps",F(7,ce)))},dependencies:[te,H,B,V,j,D,$,X,W,J,K,Q,ee,Y,O,U,ae,oe,A,N,z,k],styles:["@media (max-width: 575px){.main-container[_ngcontent-%COMP%]{padding-top:2vh!important}}.go-back-buttom[_ngcontent-%COMP%]{cursor:pointer}.main-container[_ngcontent-%COMP%]{padding:4vh 4vw;height:max-content}#no-data-logo[_ngcontent-%COMP%]{fill:var(--p-tabs-tabpanel-color);width:max-content;height:max-content}  .p-tablist-tab-list, .p-tabpanels[_ngcontent-%COMP%], .p-tablist[_ngcontent-%COMP%]{background-color:transparent!important;z-index:0}  p-accordion .p-ink{display:none}  .p-accordioncontent-content{border-radius:inherit}  .my-requests .p-dataview-content{border-radius:var(--p-content-border-radius)}"]})};export{de as RequestsList};
