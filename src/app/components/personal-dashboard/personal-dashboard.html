<div class="personal-dashboard-container">
  <div class="dashboard-header">
    <div class="header-content">
      <h2 class="header-title">Mi Dashboard</h2>
      <p class="header-subtitle">Estadísticas personales de tu actividad</p>
    </div>
  </div>

  @if(loading) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Cargando estadísticas personales...</p>
    </div>
  } @else if(groupedStatsKeys && groupedStatsKeys.length > 0) {
    <div class="stats-content">
      @for (groupName of groupedStatsKeys; track $index) {
        <div class="stats-group">
          <h3 class="group-title">{{ groupName }}</h3>
          <div class="stats-grid">
            @for (item of groupedStats[groupName]; track $index) {
              <div class="stat-card" [attr.data-severity]="item.severity">
                <div class="stat-card-header">
                  <i class="stat-icon" [class]="item.icon"></i>
                  <h4 class="stat-label">{{ item.label }}</h4>
                </div>
                <div class="stat-card-body">
                  @if (typeof item.value === 'number') {
                    <div class="stat-value">{{ item.value }}</div>
                  } @else if (typeof item.value === 'string') {
                    <div class="stat-value-text">{{ item.value }}</div>
                  } @else {
                    <div class="stat-value-json">
                      <pre>{{ item.value | json }}</pre>
                    </div>
                  }
                </div>
              </div>
            }
          </div>
        </div>
      }

      <!-- SECCIÓN RESUMEN GENERAL -->
      <div class="stats-group">
        <h3 class="group-title">Resumen General</h3>
        <div class="stats-grid">
          <div class="stat-card" [attr.data-severity]="'info'">
            <div class="stat-card-header">
              <i class="stat-icon pi pi-shopping-bag"></i>
              <h4 class="stat-label">Total de productos</h4>
            </div>
            <div class="stat-card-body">
              <div class="stat-value">{{ (personalStats?.productos_creados || 0) + (personalStats?.productos_disponibles || 0) + (personalStats?.productos_solicitados_por_usuario || 0) }}</div>
            </div>
          </div>
          <div class="stat-card" [attr.data-severity]="'warning'">
            <div class="stat-card-header">
              <i class="stat-icon pi pi-bell"></i>
              <h4 class="stat-label">Pendiente de revisar</h4>
            </div>
            <div class="stat-card-body">
              <div class="stat-value">{{ personalStats?.notificaciones_no_leidas || 0 }}</div>
            </div>
          </div>
          <div class="stat-card" [attr.data-severity]="'success'">
            <div class="stat-card-header">
              <i class="stat-icon pi pi-chart-bar"></i>
              <h4 class="stat-label">Actividad total</h4>
            </div>
            <div class="stat-card-body">
              <div class="stat-value">{{ (personalStats?.mensajes_enviados || 0) + (personalStats?.notificaciones_no_leidas || 0) }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- SECCIÓN ESTADO DE PRODUCTOS -->
      <div class="stats-group">
        <h3 class="group-title">Estado de Productos</h3>
        <div class="stats-grid">
          <div class="stat-card" [attr.data-severity]="'info'">
            <div class="stat-card-header">
              <i class="stat-icon pi pi-inbox"></i>
              <h4 class="stat-label">Creados</h4>
            </div>
            <div class="stat-card-body">
              <div class="stat-value">{{ personalStats?.productos_creados || 0 }}</div>
            </div>
          </div>
          <div class="stat-card" [attr.data-severity]="'success'">
            <div class="stat-card-header">
              <i class="stat-icon pi pi-check-circle"></i>
              <h4 class="stat-label">Disponibles</h4>
            </div>
            <div class="stat-card-body">
              <div class="stat-value">{{ personalStats?.productos_disponibles || 0 }}</div>
            </div>
          </div>
          <div class="stat-card" [attr.data-severity]="'warning'">
            <div class="stat-card-header">
              <i class="stat-icon pi pi-exclamation-circle"></i>
              <h4 class="stat-label">Solicitados</h4>
            </div>
            <div class="stat-card-body">
              <div class="stat-value">{{ personalStats?.productos_solicitados_por_usuario || 0 }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- SECCIÓN COMUNICACIÓN -->
      <div class="stats-group">
        <h3 class="group-title">Comunicación</h3>
        <div class="stats-grid">
          <div class="stat-card" [attr.data-severity]="'info'">
            <div class="stat-card-header">
              <i class="stat-icon pi pi-envelope"></i>
              <h4 class="stat-label">Mensajes</h4>
            </div>
            <div class="stat-card-body">
              <div class="stat-value">{{ personalStats?.mensajes_enviados || 0 }}</div>
            </div>
          </div>
          <div class="stat-card" [attr.data-severity]="'danger'">
            <div class="stat-card-header">
              <i class="stat-icon pi pi-bell-slash"></i>
              <h4 class="stat-label">No leído</h4>
            </div>
            <div class="stat-card-body">
              <div class="stat-value">{{ personalStats?.notificaciones_no_leidas || 0 }}</div>
            </div>
          </div>
          <div class="stat-card" [attr.data-severity]="'secondary'">
            <div class="stat-card-header">
              <i class="stat-icon pi pi-comments"></i>
              <h4 class="stat-label">Total de interacción</h4>
            </div>
            <div class="stat-card-body">
              <div class="stat-value">{{ (personalStats?.mensajes_enviados || 0) + (personalStats?.notificaciones_no_leidas || 0) + (personalStats?.productos_solicitados_por_usuario || 0) }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- SECCIÓN ANÁLISIS DE ACTIVIDAD -->
      <div class="stats-group">
        <h3 class="group-title">Análisis de Actividad</h3>
        <div class="stats-grid">
          <div class="stat-card" [attr.data-severity]="'success'">
            <div class="stat-card-header">
              <i class="stat-icon pi pi-user"></i>
              <h4 class="stat-label">Tasa de disponibilidad</h4>
            </div>
            <div class="stat-card-body">
              <div class="stat-value">{{ personalStats?.productos_disponibles && personalStats?.productos_creados && personalStats?.productos_creados > 0 ? ((personalStats.productos_disponibles / personalStats.productos_creados) * 100 | number:'1.0-0') : 0 }}%</div>
            </div>
          </div>
          <div class="stat-card" [attr.data-severity]="'info'">
            <div class="stat-card-header">
              <i class="stat-icon pi pi-percentage"></i>
              <h4 class="stat-label">Ratio de demanda</h4>
            </div>
            <div class="stat-card-body">
              <div class="stat-value">{{ personalStats?.productos_solicitados_por_usuario && personalStats?.productos_disponibles && personalStats?.productos_disponibles > 0 ? ((personalStats.productos_solicitados_por_usuario / personalStats.productos_disponibles) * 100 | number:'1.0-0') : 0 }}%</div>
            </div>
          </div>
          <div class="stat-card" [attr.data-severity]="'warning'">
            <div class="stat-card-header">
              <i class="stat-icon pi pi-chart-line"></i>
              <h4 class="stat-label">Promedio de actividad</h4>
            </div>
            <div class="stat-card-body">
              <div class="stat-value">{{ ((personalStats?.productos_creados || 0) + (personalStats?.mensajes_enviados || 0)) / 2 | number:'1.0-0' }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- SECCIÓN COMPARATIVA -->
      <div class="stats-group">
        <h3 class="group-title">Tu Situación</h3>
        <div class="stats-grid">
          <div class="stat-card" [attr.data-severity]="'info'">
            <div class="stat-card-header">
              <i class="stat-icon pi pi-inbox"></i>
              <h4 class="stat-label">Total creado</h4>
            </div>
            <div class="stat-card-body">
              <div class="stat-value">{{ personalStats?.productos_creados || 0 }}</div>
            </div>
          </div>
          <div class="stat-card" [attr.data-severity]="'success'">
            <div class="stat-card-header">
              <i class="stat-icon pi pi-check-circle"></i>
              <h4 class="stat-label">Aún disponible</h4>
            </div>
            <div class="stat-card-body">
              <div class="stat-value">{{ personalStats?.productos_disponibles || 0 }}</div>
            </div>
          </div>
          <div class="stat-card" [attr.data-severity]="'warning'">
            <div class="stat-card-header">
              <i class="stat-icon pi pi-arrow-right"></i>
              <h4 class="stat-label">Entregado</h4>
            </div>
            <div class="stat-card-body">
              <div class="stat-value">{{ (personalStats?.productos_creados || 0) - (personalStats?.productos_disponibles || 0) }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- SECCIÓN PARTICIPACIÓN E IMPACTO -->
      <div class="stats-group">
        <h3 class="group-title">Tu Impacto</h3>
        <div class="stats-grid">
          <div class="stat-card" [attr.data-severity]="'secondary'">
            <div class="stat-card-header">
              <i class="stat-icon pi pi-send"></i>
              <h4 class="stat-label">Mensajes activos</h4>
            </div>
            <div class="stat-card-body">
              <div class="stat-value">{{ personalStats?.mensajes_enviados || 0 }}</div>
            </div>
          </div>
          <div class="stat-card" [attr.data-severity]="'info'">
            <div class="stat-card-header">
              <i class="stat-icon pi pi-volume-off"></i>
              <h4 class="stat-label">Solicitudes pendientes</h4>
            </div>
            <div class="stat-card-body">
              <div class="stat-value">{{ personalStats?.productos_solicitados_por_usuario || 0 }}</div>
            </div>
          </div>
          <div class="stat-card" [attr.data-severity]="'success'">
            <div class="stat-card-header">
              <i class="stat-icon pi pi-star"></i>
              <h4 class="stat-label">Tasa de cumplimiento</h4>
            </div>
            <div class="stat-card-body">
              <div class="stat-value">{{ personalStats?.productos_creados && personalStats?.productos_creados > 0 ? (((personalStats?.productos_creados - (personalStats?.productos_disponibles || 0)) / personalStats?.productos_creados) * 100 | number:'1.0-0') : 0 }}%</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  } @else {
    <div class="no-data-container">
      <i class="pi pi-inbox"></i>
      <p>No hay datos disponibles para mostrar</p>
    </div>
  }
</div>
