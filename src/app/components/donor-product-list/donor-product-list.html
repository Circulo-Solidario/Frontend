<div id="main" class="main-container container-fluid">
  <div class="col-auto justify-content-center align-content-center h-100">
    <div class="d-flex row mb-2">
      <h1 class="d-flex align-items-center mb-0">
        <i class="pi pi-chevron-left me-3 go-back-buttom" (click)="goHome()"></i> Mis publicaciones
      </h1>
    </div>
    <div class="row">
      <p-dataview #dv [value]="products" [layout]="layout" toggleButtonProps="">
        <ng-template #header>
          <div class="d-flex justify-content-between align-items-center">
            <p-selectbutton [(ngModel)]="layout" [options]="options" [allowEmpty]="false">
              <ng-template #item let-item>
                <i class="pi " [ngClass]="{ 'pi-bars': item === 'list', 'pi-table': item === 'grid' }"></i>
              </ng-template>
            </p-selectbutton>
          </div>
        </ng-template>
        <ng-template #list let-items>
          <div [class.p-3]="items">
            @for (item of items; track $index) {
            <div class="d-flex border rounded flex-row p-3 gap-3 list" [class.mt-3]="$index != 0">
              <div class="position-relative">
                <img
                  class="d-block mx-auto rounded image"
                  [src]="item.urlImagen"
                  [alt]="item.nombre"
                />
                <p-tag
                  [value]="item.estado.replace('_', ' ')"
                  [severity]="getSeverity(item)"
                  class="position-absolute bg-dark"
                  style="left: 4px; top: 4px"
                ></p-tag>
              </div>
              <div
                class="d-flex flex-column flex-sm-row justify-content-between align-items-center align-items-sm-start flex-grow-1 gap-4"
              >
                <div
                  class="d-flex flex-row flex-md-column justify-content-evenly align-items-start gap-2"
                >
                  <div>
                    <div class="fw-medium fs-5 mt-2">{{ item.nombre }}</div>
                    <span class="fw-medium text-secondary small">{{ item.categoria.nombre }}</span>
                  </div>
                </div>
                <div class="d-flex flex-column align-items-md-end gap-3">
                  <div class="d-flex flex-row-reverse flex-md-row gap-2">
                    <p-button
                      icon="pi pi-pencil"
                      label="Editar"
                      class="flex-grow-1 flex-md-grow-0 text-nowrap"
                      (onClick)="editProduct(item.id)"
                    ></p-button>
                    <p-button
                      icon="pi pi-times"
                      label="Eliminar"
                      class="flex-grow-1 flex-md-grow-0 text-nowrap"
                      severity="danger"
                      (onClick)="deleteProduct($event, item.id)"
                    ></p-button>
                  </div>
                </div>
              </div>
            </div>
            }
          </div>
        </ng-template>
        <ng-template #grid let-items>
          <div
            class="d-inline-flex justify-content-center row row-cols-auto g-3"
            [class.p-3]="items"
          >
            @for (item of items; track $index) {
            <div class="p-3 mx-2 border rounded col card">
              <div class="d-flex justify-content-center rounded p-0">
                <div class="position-relative mx-auto">
                  <img class="rounded card-image" [src]="item.urlImagen" [alt]="item.nombre" />
                  <p-tag
                    [value]="item.estado.replace('_', ' ')"
                    [severity]="getSeverity(item)"
                    class="position-absolute bg-dark"
                    style="left: 4px; top: 4px"
                  ></p-tag>
                </div>
              </div>
              <div class="pt-2">
                <div class="d-flex flex-row justify-content-between align-items-start gap-2">
                  <div>
                    <div class="fw-medium fs-5 mt-1">{{ item.nombre }}</div>
                    <span class="fw-medium text-secondary small">{{ item.categoria.nombre }}</span>
                  </div>
                </div>
                <div class="d-flex flex-column align-items-center gap-3 mt-3">
                  <div class="d-flex gap-2">
                    <p-button
                      icon="pi pi-pencil"
                      label=""
                      class="flex-grow-1 text-nowrap"
                      (onClick)="editProduct(item.id)"
                    ></p-button>
                    <p-button
                      icon="pi pi-times"
                      label=""
                      class="flex-grow-1 text-nowrap"
                      severity="danger"
                      (onClick)="deleteProduct($event, item.id)"
                    ></p-button>
                  </div>
                </div>
              </div>
            </div>
            }
          </div>
        </ng-template>
        <ng-template #emptymessage>
          @if(!isLoading){
          <div class="row py-3 justify-content-center text-center">
            <svg
              version="1.0"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 420 500"
              id="no-data-logo"
              width="150"
              height="150"
            >
              <metadata>Created by potrace 1.10, written by Peter Selinger 2001-2011</metadata>
              <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" stroke="none">
                <path
                  d="M2885 5114 c-220 -31 -373 -77 -528 -156 -407 -209 -693 -590 -784 -1045 -24 -123 -24 -413 0 -536 49 -244 180 -520 323 -680 19 -20 34 -40 34 -44 0 -4 -59 -67 -132 -140 l-131 -131 -39 26 c-47 30 -127 40 -184 22 -32 -10 -169 -142 -711 -683 -474 -473 -679 -685 -698 -719 -60 -110 -41 -234 49 -324 90 -90 214 -109 324 -49 34 19 246 224 719 698 541 542 673 679 683 711 18 57 8 137 -22 184 l-26 39 133 133 c124 123 135 132 153 119 10 -8 59 -45 108 -82 158 -120 380 -217 604 -264 118 -24 409 -24 533 0 607 121 1071 588 1183 1192 26 137 26 383 0 520 -111 597 -574 1069 -1162 1185 -104 21 -355 35 -429 24z m385 -149 c278 -54 496 -170 700 -375 206 -205 320 -419 376 -705 27 -134 24 -367 -5 -505 -74 -350 -283 -660 -573 -851 -114 -75 -157 -97 -278 -142 -159 -59 -280 -80 -465 -80 -182 0 -299 19 -458 77 -117 43 -169 69 -285 145 -295 194 -510 519 -578 871 -24 127 -24 361 0 485 35 183 107 360 211 515 57 85 200 238 278 298 198 153 434 251 679 282 98 12 294 5 398 -15z m-1653 -2728 c95 -95 95 -106 6 -198 l-67 -70 -103 103 -104 103 70 68 c92 90 102 89 198 -6z m-709 -915 c-443 -443 -560 -555 -591 -564 -99 -30 -201 65 -182 170 6 32 77 107 563 594 l557 558 102 -102 103 -103 -552 -553z"
                />
                <path
                  d="M2915 4833 c-130 -11 -309 -64 -438 -130 -60 -30 -160 -96 -188 -124 -25 -25 -24 -64 1 -89 28 -28 59 -25 106 9 254 187 592 251 899 170 369 -96 660 -387 754 -754 80 -310 17 -645 -170 -899 -34 -47 -37 -78 -9 -106 25 -25 64 -26 89 -1 53 53 129 185 181 315 75 189 96 456 51 664 -108 509 -520 882 -1040 942 -83 10 -153 10 -236 3z"
                />
                <path
                  d="M2102 4393 c-18 -7 -103 -135 -144 -218 -199 -399 -155 -890 113 -1245 347 -459 973 -608 1484 -352 90 45 211 126 219 147 11 30 6 55 -14 75 -27 27 -59 25 -101 -6 -354 -265 -852 -277 -1224 -29 -484 322 -614 983 -290 1470 30 46 55 93 55 104 0 42 -53 72 -98 54z"
                />
                <path
                  d="M2487 4042 c-33 -36 -22 -73 38 -132 l55 -54 -55 -56 c-63 -63 -73 -106 -33 -134 37 -26 60 -19 120 41 l57 57 60 -57 c65 -62 97 -71 131 -37 34 34 25 66 -37 131 l-57 60 53 51 c59 60 70 88 47 123 -12 18 -25 25 -49 25 -26 0 -43 -11 -87 -55 l-54 -54 -57 54 c-63 60 -102 71 -132 37z"
                />
                <path
                  d="M3186 4038 c-26 -37 -19 -60 41 -120 l57 -57 -57 -60 c-62 -65 -71 -97 -37 -131 34 -34 66 -25 130 36 l58 56 59 -56 c32 -31 67 -56 78 -56 36 0 65 28 65 63 0 26 -11 43 -55 87 l-55 54 55 56 c60 61 72 102 37 133 -34 31 -69 21 -131 -38 l-57 -54 -54 54 c-62 63 -106 74 -134 33z"
                />
                <path
                  d="M2923 3350 c-107 -20 -259 -97 -298 -153 -20 -29 -19 -70 3 -90 30 -27 70 -21 115 18 56 48 113 74 205 92 71 14 86 14 156 0 92 -19 147 -44 203 -92 65 -55 133 -40 133 29 0 53 -126 144 -250 180 -68 20 -199 28 -267 16z"
                />
              </g>
            </svg>
            <h2>Sin resultados</h2>
            <span>No se encontraron productos que coincidan con la b√∫squeda</span>
          </div>
          }
        </ng-template>
      </p-dataview>
    </div>
  </div>
  <p-scrolltop
    target="parent"
    [threshold]="100"
    icon="pi pi-arrow-up"
    [buttonProps]="{ severity: 'contrast', raised: true, rounded: true }"
  />
  <p-confirmdialog />
</div>
