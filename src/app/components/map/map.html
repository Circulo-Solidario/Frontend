<div class="main-container container-fluid pt-3">
  <div class="col d-flex flex-column h-100">
    <h1 class="d-flex my-2 align-items-center mb-4">
      <i class="pi pi-chevron-left me-3 go-back-buttom" (click)="goBack()"></i>
      Personas en situación de calle
    </h1>
    <div class="map-wrapper">
      <div id="people-map"></div>
      <div class="map-controls-left">
        <p-menu #pickPointMenu [popup]="true" [model]="pickPointItems" [appendTo]="'body'"></p-menu>
        <div class="left-buttons-group">
          <p-button
            icon="pi pi-flag"
            [rounded]="true"
            severity="secondary"
            class="control-btn"
            title="Marcar un punto"
            (onClick)="openPickPointMenu($event)">
          </p-button>
          <p-button
            icon="pi pi-eye"
            [rounded]="true"
            severity="secondary"
            class="control-btn"
            [pTooltip]="legendContent"
            tooltipPosition="right"
            [escape]="false"
            tooltipStyleClass="legend-tooltip">
          </p-button>
        </div>
      </div>
      <div class="map-controls">
        <p-button 
          icon="pi pi-plus" 
          [rounded]="true" 
          severity="secondary"
          (onClick)="zoomIn()"
          class="control-btn"
          title="Aumentar zoom">
        </p-button>
        <p-button 
          icon="pi pi-minus" 
          [rounded]="true" 
          severity="secondary"
          (onClick)="zoomOut()"
          class="control-btn"
          title="Disminuir zoom">
        </p-button>
        <p-button 
          icon="pi pi-map-marker" 
          [rounded]="true" 
          severity="secondary"
          (onClick)="centerToCurrentLocation()"
          class="control-btn"
          title="Centrar en mi ubicación">
        </p-button>
      </div>
    </div>
  </div>
</div>
<p-dialog
  [(visible)]="showPointDialog"
  [header]="'Descripción del punto'"
  [modal]="true"
  [closable]="false"
  [draggable]="false"
  styleClass="point-dialog"
  [style]="{ width: '90%', maxWidth: '500px' }">
  
  <div class="dialog-content">
    <label for="description" class="block mb-2">Descripción *</label>
    <textarea
      pInputText
      id="description"
      [(ngModel)]="pointDescription"
      rows="5"
      [maxlength]="maxDescriptionLength"
      placeholder="Describe la situación o necesidad del punto..."
      class="w-100"
      style="resize: none; font-family: inherit;"></textarea>
    <small class="text-muted d-block mt-2">
      {{ pointDescription.length }} / {{ maxDescriptionLength }} caracteres
    </small>
  </div>

  <ng-template #footer>
    <p-button
      label="Cancelar"
      icon="pi pi-times"
      (onClick)="cancelPoint()"
      [loading]="isLoadingPoint"
      severity="secondary">
    </p-button>
    <p-button
      label="Guardar"
      icon="pi pi-save"
      (onClick)="savePoint()"
      [loading]="isLoadingPoint"
      [disabled]="!pointDescription.trim() || isLoadingPoint">
    </p-button>
  </ng-template>
</p-dialog>
<p-dialog
  [(visible)]="showMarkAsAttendedDialog"
  [header]="'Confirmar'"
  [modal]="true"
  [closable]="false"
  [draggable]="false"
  styleClass="point-dialog"
  [style]="{ width: '90%', maxWidth: '400px' }">
  
  <div class="dialog-content">
    <p class="mb-0">¿Desea marcar como atendidas las necesidades?</p>
  </div>

  <ng-template #footer>
    <p-button
      label="Cancelar"
      icon="pi pi-times"
      (onClick)="cancelMarkAsAttended()"
      [loading]="isMarkingAsAttended"
      severity="secondary">
    </p-button>
    <p-button
      label="Aceptar"
      icon="pi pi-check"
      (onClick)="confirmMarkAsAttended()"
      [loading]="isMarkingAsAttended">
    </p-button>
  </ng-template>
</p-dialog>