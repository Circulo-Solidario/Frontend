import{a as l}from"./chunk-R4M2EAJZ.js";import{C as t,s as h}from"./chunk-QOJUQ6XD.js";import{$ as i,da as a,e as u,n as r}from"./chunk-A4JG42N6.js";var c=u(l());var o=class s{constructor(e){this.http=e;this.pusher=new c.default(t.pusherKey,{cluster:t.pusherCluster,forceTLS:!0})}pusher;channel=null;messageSubject=new r({});get messages$(){return this.messageSubject.asObservable()}joinRoom(e){this.channel&&(this.channel.unbind_all(),this.pusher.unsubscribe(this.channel.name)),this.channel=this.pusher.subscribe(e),this.channel.bind("new-message",n=>{this.messageSubject.next(n)})}sendMessage(e){return this.http.post(`${t.apiUrl}/mensajes/enviar`,e)}getRoomMessages(e){return this.http.get(`${t.apiUrl}/mensajes/sala/${e}`)}disconnect(){this.channel&&this.pusher.unsubscribe(this.channel.name),this.pusher&&this.pusher.disconnect()}static \u0275fac=function(n){return new(n||s)(a(h))};static \u0275prov=i({token:s,factory:s.\u0275fac,providedIn:"root"})};export{o as a};
