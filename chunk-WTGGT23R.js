import{a as ne,b as le}from"./chunk-MMK4CH2P.js";import{a as ae}from"./chunk-4FDTJGBB.js";import{a as re,b as oe}from"./chunk-7AHVG7ZA.js";import{a as te,b as ie}from"./chunk-T4MU4AB4.js";import"./chunk-BOTTEXY6.js";import"./chunk-FQGKTMLL.js";import"./chunk-DTLGCBUS.js";import"./chunk-7QH3DEV4.js";import{a as Y,b as Z}from"./chunk-TDFDGLCL.js";import{a as ee}from"./chunk-DW6VR7TT.js";import{a as S,c as K}from"./chunk-ZXYQCOEA.js";import"./chunk-QD7ZASQF.js";import"./chunk-BPTCD5M7.js";import{a as H}from"./chunk-3DND4RW6.js";import"./chunk-7QJ2EETJ.js";import"./chunk-EL5SIMWJ.js";import"./chunk-FKOEVO4B.js";import{a as J}from"./chunk-M7F2YWVM.js";import{a as X}from"./chunk-D5OLY3RM.js";import{C as B,b as O,c as h,e as G,f as L,g as Q,h as b,k as z,l as $,n as q,o as A}from"./chunk-CQCVERZP.js";import"./chunk-4G3JCKZK.js";import"./chunk-4O3FVBGX.js";import{D as W,l as R,x as N}from"./chunk-QOJUQ6XD.js";import{$b as k,Bb as _,Cb as v,Db as F,Ec as y,Fb as I,Gb as V,Hb as d,Ib as o,Jb as n,Kb as m,Rb as C,Va as w,Wb as g,Xb as f,Za as s,a as P,ac as M,bc as j,ea as c,g as E,ja as p,jb as U,jc as l,ka as u,lc as D,pb as T}from"./chunk-A4JG42N6.js";function me(i,r){}function de(i,r){if(i&1&&(o(0,"div",35),m(1,"img",36),n()),i&2){let t=f(2);s(),d("src",t.imagenUrl,w)}}function pe(i,r){if(i&1&&(o(0,"div",35),m(1,"img",37),n()),i&2){let t=r.$implicit;s(),d("alt",t.name)("src",t.objectURL,w)}}function ue(i,r){if(i&1&&I(0,pe,2,2,"div",35,F),i&2){let t=f().$implicit;V(t)}}function ge(i,r){if(i&1&&_(0,de,2,1,"div",35)(1,ue,2,0),i&2){let t=r.$implicit,e=f();v(e.imagenUrl?0:t.length>0?1:-1)}}function fe(i,r){i&1&&(o(0,"div",38),m(1,"i",39),o(2,"p",40),l(3,"Carga una imagen"),n()())}function he(i,r){if(i&1&&_(0,fe,4,0,"div",38),i&2){let t=f();v(t.imagenUrl?-1:0)}}function _e(i,r){if(i&1){let t=C();o(0,"p-button",41),g("onClick",function(){p(t);let a=f();return u(a.choose())}),n()}}function ve(i,r){if(i&1){let t=C();o(0,"p-button",42),g("onClick",function(){p(t);let a=f();return u(a.clearImage())}),n()}}function Ce(i,r){i&1&&m(0,"i",34)}var se=class i{fileUpload;router=c(N);categoriesService=c(ne);loginService=c(X);permissionsService=c(ee);productService=c(ae);imageService=c(K);toasts=c(W);geolocationService=c(le);loggedUser;productForm;imagen=null;setUploading=!1;imagenUrl=null;categories;coords=null;constructor(){this.productForm=new Q({nombre:new b("",[h.required,h.minLength(4)]),descripcion:new b("",[h.required,h.minLength(4),h.maxLength(255)]),categoriaId:new b(null,[h.required])})}ngOnInit(){this.loginService.getLoggedUser().subscribe(r=>{if(this.loggedUser=r,!this.loggedUser){this.router.navigate(["/login"]);return}if(!this.permissionsService.canAccessRoute(r,this.router.url)){this.router.navigate(["/principal"]);return}}),this.categoriesService.getCategories().subscribe({next:r=>{this.categories=r},error:()=>{this.toasts.showToast({severity:"error",summary:"Error al cargar categor\xEDas",text:"No se pudieron cargar las categor\xEDas, intente mas tarde..."})}})}goHome(){this.router.navigate(["/principal"])}setImage(r){if(!"|image/jpg|image/jpeg|image/png|".includes(r.files[0].type)){this.showImageError();return}this.imagen=r.files[0];let t=new FileReader;t.onload=()=>{this.imagenUrl=t.result},t.readAsDataURL(this.imagen)}choose(){this.fileUpload.choose()}showImageError(){this.toasts.showToast({severity:"error",summary:"Formato de imagen inv\xE1lido",detail:"Formatos admitidos: jpg, png o jpeg"})}clearImage(){this.fileUpload.clear(),this.imagen=null,this.imagenUrl=null}onSubmit(){return E(this,null,function*(){if(this.setUploading=!0,this.productForm.invalid){this.setUploading=!1;return}try{let e=yield this.geolocationService.getCurrentPosition();this.coords=e.coords}catch(e){this.toasts.showToast({severity:"error",summary:"Error de ubicaci\xF3n",detail:`${e.message}`}),this.setUploading=!1;return}let r=!1;if(this.imagen){let e={image:this.imagen};try{let a=yield this.imageService.uploadImage(e);this.imagenUrl=a.data.url}catch{r=!0}}else{this.toasts.showToast({severity:"error",summary:"Error al registrar producto",detail:"Ingrese correctamente los campos obligatorios"}),this.setUploading=!1;return}if(r||!this.imagenUrl){this.toasts.showToast({severity:"error",summary:"Error al guardar imagen",detail:"No se pudo guardar la imagen correctamente, intente m\xE1s tarde..."}),this.setUploading=!1;return}let t=P({latitud:this.coords.latitude,longitud:this.coords.longitude,idUsuario:this.loggedUser.id,urlImagen:this.imagenUrl},this.productForm.value);this.productService.publishProduct(t).subscribe({next:e=>{this.toasts.showToast({severity:"success",summary:"Producto publicado!",detail:`Producto "${e.nombre}" publicado con \xE9xito`}),this.router.navigate(["/principal"]),this.setUploading=!1},error:e=>{this.toasts.showToast({severity:"error",summary:"Producto no publicado",detail:"No pudimos publicar tu producto, intente nuevamente"}),this.setUploading=!1}})})}cancel(){this.clearImage(),this.productForm.get("nombre")?.setValue(""),this.productForm.get("categoria")?.setValue(null),this.productForm.get("descripcion")?.setValue(""),this.productForm.markAsPristine()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=U({type:i,selectors:[["app-create-product"]],viewQuery:function(t,e){if(t&1&&k(S,5),t&2){let a;M(a=j())&&(e.fileUpload=a.first)}},decls:56,vars:11,consts:[["header",""],["content",""],["empty",""],[1,"main-container","container-fluid"],[1,"col-auto","justify-content-center","align-content-center","h-100"],[1,"d-flex","my-2","align-items-center","mb-4"],[1,"pi","pi-chevron-left","me-3","go-back-buttom",3,"click"],[1,"p-fluid","p-4",3,"formGroup"],[1,"row","w-100"],[1,"col-12","col-sm-12","col-md-12","col-lg-4","text-center"],["for","inputImage"],[2,"color","red"],["name","inputImage","accept",".jpg,.png,.jpeg","maxFileSize","1000000","styleClass","mt-2",3,"onSelect","multiple"],["styleClass","mt-2","label","Elegir","icon","pi pi-upload"],["styleClass","mt-2","label","Quitar","icon","pi pi-times","severity","danger"],[1,"col-12","col-sm-12","col-md-12","col-lg-8","mt-4","mt-lg-0"],[1,"row-gap-0"],["for","title"],["name","title","placeholder","Ej: Remera de algod\xF3n","pInputText","","type","text","fluid","","formControlName","nombre",1,"mt-2"],[1,"mt-4","row-gap-0"],["for","description"],["name","description","placeholder","Describe el producto detalladamente...","formControlName","descripcion","rows","5","cols","30","pTextarea","","fluid","",1,"mt-2"],[1,"mt-4","row"],[1,"col-12","col-sm-12","col-md-6","col-lg-6"],["for","category"],["name","category","formControlName","categoriaId","optionLabel","nombre","optionValue","id","fluid","","fluid","",1,"mt-2",3,"loading","options","placeholder","showClear"],[1,"col-12","col-sm-12","col-md-6","col-lg-6","mt-4","mt-md-0","mt-lg-0"],["for","title",1,"p-0"],[1,"d-flex","row-gap-0","mt-2","py-2","align-content-center"],["name","","icon","pi pi-check","severity","success","value","Disponible","fluid","",1,"w-100"],[1,"row","w-100","justify-content-end"],[1,"col-auto","mt-4"],["label","Cancelar","severity","secondary",1,"me-4",3,"onClick","disabled"],[3,"onClick","disabled"],[1,"pi","pi-spin","pi-spinner"],[1,"flex","items-center","justify-center","flex-col"],["role","presentation","alt","Imagen cargada",3,"src"],["role","presentation",3,"alt","src"],[1,"justify-content-center","align-items-center","empty-content","no-image"],[1,"pi","pi-file-arrow-up",2,"font-size","2.5rem"],[1,"mt-6","mb-0"],["styleClass","mt-2","label","Elegir","icon","pi pi-upload",3,"onClick"],["styleClass","mt-2","label","Quitar","icon","pi pi-times","severity","danger",3,"onClick"]],template:function(t,e){if(t&1){let a=C();o(0,"div",3)(1,"div",4)(2,"h1",5)(3,"i",6),g("click",function(){return p(a),u(e.goHome())}),n(),l(4," Publicar producto "),n(),o(5,"p-card")(6,"div",7)(7,"div",8)(8,"div",9)(9,"label",10),l(10,"Imagen del producto"),o(11,"span",11),l(12,"\u2002*"),n()(),o(13,"p-fileupload",12),g("onSelect",function(ce){return p(a),u(e.setImage(ce))}),T(14,me,0,0,"ng-template",null,0,y)(16,ge,2,1,"ng-template",null,1,y)(18,he,1,1,"ng-template",null,2,y),n(),_(20,_e,1,0,"p-button",13)(21,ve,1,0,"p-button",14),n(),o(22,"div",15)(23,"div",16)(24,"label",17),l(25,"T\xEDtulo del producto"),o(26,"span",11),l(27,"\u2002*"),n()(),m(28,"input",18),n(),o(29,"div",19)(30,"label",20),l(31,"Descripci\xF3n"),o(32,"span",11),l(33,"\u2002*"),n(),o(34,"span"),l(35),n()(),m(36,"textarea",21),n(),o(37,"div",22)(38,"div",23)(39,"label",24),l(40,"Categor\xEDa"),o(41,"span",11),l(42,"\u2002*"),n()(),m(43,"p-select",25),n(),o(44,"div",26)(45,"div",16)(46,"label",27),l(47,"Estado"),n()(),o(48,"div",28),m(49,"p-tag",29),n()()()()(),o(50,"div",30)(51,"div",31)(52,"p-button",32),g("onClick",function(){return p(a),u(e.cancel())}),n(),o(53,"p-button",33),g("onClick",function(){return p(a),u(e.onSubmit())}),l(54," Publicar"),_(55,Ce,1,0,"i",34),n()()()()()()()}if(t&2){let a;s(6),d("formGroup",e.productForm),s(7),d("multiple",!1),s(7),v(e.imagen?21:20),s(15),D("\u2002(",((a=e.productForm.get("descripcion"))==null?null:a.value.length)??0,"/255)"),s(8),d("loading",!e.categories)("options",e.categories)("placeholder",e.categories?"Seleccione una categor\xEDa":"")("showClear",!0),s(9),d("disabled",e.productForm.pristine&&!e.imagen||e.setUploading),s(),d("disabled",e.productForm.invalid||!e.imagen||e.setUploading),s(2),v(e.setUploading?55:-1)}},dependencies:[R,A,O,G,L,z,$,q,H,B,S,ie,te,J,oe,re,Z,Y],styles:["@media (max-width: 412px){.profile-data[_ngcontent-%COMP%]{justify-content:center}}@media (max-width: 575px){.main-container[_ngcontent-%COMP%]{padding-top:2vh!important}}img[_ngcontent-%COMP%]{max-height:30vh;height:30vh;width:auto;max-width:100%;border-radius:var(--p-fileupload-border-radius);object-fit:cover}.no-image[_ngcontent-%COMP%]{min-height:30vh}.empty-content[_ngcontent-%COMP%]{height:21vh;align-content:center}textarea[_ngcontent-%COMP%]{resize:vertical;min-height:10vh;max-height:25vh}  .p-fileupload-header{display:none!important}  .p-fileupload-content{padding:1.25rem}.go-back-buttom[_ngcontent-%COMP%]{cursor:pointer}.main-container[_ngcontent-%COMP%]{padding:4vh 4vw;height:max-content}"]})};export{se as CreateProduct};
