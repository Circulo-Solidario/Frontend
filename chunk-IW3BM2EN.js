import{a as ee}from"./chunk-LNBGOKAC.js";import{a as te}from"./chunk-JQLK4AHE.js";import{a as ae}from"./chunk-A6NZNUHX.js";import{a as ie}from"./chunk-SGMXIVTQ.js";import"./chunk-DVFEINU7.js";import{b as J}from"./chunk-R4M2EAJZ.js";import{a as H}from"./chunk-CYTZBTDE.js";import{a as Z}from"./chunk-4FDTJGBB.js";import{a as X,b as Y}from"./chunk-T4MU4AB4.js";import{a as K}from"./chunk-TDFDGLCL.js";import{a as Q}from"./chunk-DW6VR7TT.js";import{a as $}from"./chunk-D5OLY3RM.js";import{C as W,b as j,e as A,i as B,m as L,n as z,u as F}from"./chunk-CQCVERZP.js";import{ba as S}from"./chunk-4G3JCKZK.js";import"./chunk-4O3FVBGX.js";import{D as G,l as N,x as V}from"./chunk-QOJUQ6XD.js";import{Bb as C,Cb as E,Db as M,Ec as q,Fb as I,Gb as O,Hb as u,Ib as i,Jb as t,Kb as m,Rb as D,Va as x,Wb as b,Xb as h,Za as n,ea as l,g as f,ja as g,jb as w,jc as s,ka as v,kc as p,lc as _,nc as T,oc as R,pb as P,pc as k,qc as U,z as y}from"./chunk-A4JG42N6.js";function oe(o,a){if(o&1&&m(0,"p-badge",30),o&2){let r=a.$implicit;u("value",r.nombre.toLowerCase())}}function ne(o,a){if(o&1&&I(0,oe,1,1,"p-badge",30,M),o&2){let r=h();O(r.donorData==null?null:r.donorData.roles)}}function se(o,a){o&1&&m(0,"p-badge",18)}function le(o,a){if(o&1){let r=D();i(0,"div",31)(1,"p"),s(2),t(),i(3,"textarea",32),k("ngModelChange",function(d){g(r);let c=h();return R(c.message,d)||(c.message=d),v(d)}),t(),i(4,"p"),s(5),t()()}if(o&2){let r=a.$implicit,e=h();n(2),p(r.message),n(),T("ngModel",e.message),n(2),_("(",e.message.length,"/255)")}}var re=class o{router=l(V);productService=l(Z);toasts=l(G);loginService=l($);permissionsService=l(Q);requestService=l(ee);notificationService=l(J);roomService=l(ie);messagesService=l(ae);confirmationService=l(S);id;filters;productData;donorData;logedUser;message="";ngOnInit(){return f(this,null,function*(){this.loginService.getLoggedUser().subscribe(e=>{if(this.logedUser=e,e==null){this.router.navigate(["/login"]);return}if(!this.permissionsService.canAccessRoute(e,this.router.url)){this.router.navigate(["/principal"]);return}});let r=this.router.currentNavigation()?.extras?.state||history.state;this.id=r?.id,this.filters=r?.filters;try{yield this.getProductData(),this.donorData=this.productData.usuario}catch{this.toasts.showToast({severity:"error",summary:"Error al obtener datos",detail:"Error al obtener datos, intente nuevamente,,,"})}})}getProductData(){return f(this,null,function*(){this.productData=yield y(this.productService.getProductDetail(this.id))})}searchRequest(){return!!this.productData?.solicitantes.find(a=>a.id==this.logedUser.id)}getSeverity(a){switch(a){case"DISPONIBLE":return"success";case"SOLICITADO":return"warn";case"RESERVADO":return"danger";case"ENTREGADO":return"danger";default:return"success"}}requestProduct(a){this.requestService.requestProduct({idSolicitante:this.logedUser.id,idProducto:this.productData.id,idDonador:this.productData.usuario.id,mensaje:a}).subscribe({next:r=>{this.toasts.showToast({severity:"success",summary:"Producto solicitado!",detail:"Notificamos al donante sobre tu solicitud"}),this.notificationService.sendNotification({tipoNotificacion:"NUEVA_SOLICITUD",deUsuario:this.logedUser.id,ausuario:this.productData.usuario.id,mensaje:`${this.logedUser.alias} te solicit\xF3 el producto ${this.productData.nombre}, dir\xEDgite a tus solicitudes para m\xE1s informaci\xF3n.`}).subscribe(),this.getProductData();try{this.roomService.getRequesterRooms(this.logedUser.id).subscribe({next:e=>{let d=e.find(c=>c?.solicitud?.producto?.id===this.productData.id&&c?.solicitud?.solicitante?.id===this.logedUser.id);if(d&&a&&a.trim()){let c={mensaje:a,idUsuario:this.logedUser.id,idSala:d.id};this.messagesService.sendMessage(c).subscribe({next:()=>{},error:()=>{}})}},error:()=>{}})}catch{}},error:()=>{this.toasts.showToast({severity:"error",summary:"Error al solicitar producto",detail:"No pudimos procesar tu solicitud, intente nuevamente..."})}})}goBack(){this.router.navigate(["/principal/busqueda"],{queryParams:{nombre:this.filters.nombre,categoria:this.filters.categoriaId,distancia:this.filters.distancia}})}openRquest(){this.confirmationService.confirm({header:"Solicitar producto",message:"Env\xEDale un mensaje al donador para solicitar el producto:",rejectButtonProps:{label:"Cancelar",variant:"outlined",size:"small"},acceptButtonProps:{label:"Solicitar",size:"small"},accept:()=>{this.requestProduct(this.message)},reject:()=>{this.message=""}})}static \u0275fac=function(r){return new(r||o)};static \u0275cmp=w({type:o,selectors:[["app-product-detail"]],features:[U([S])],decls:45,vars:12,consts:[["message",""],[1,"main-container","container-fluid","pt-3"],[1,"col-auto","justify-content-center","align-content-center","h-100"],[1,"d-flex","my-2","align-items-center","mb-4"],[1,"pi","pi-chevron-left","me-3","go-back-buttom",3,"click"],[1,"container-fluid"],[1,"row","m-auto","justify-content-center","w-75","row-cols-2","p-4","product-content"],[1,"col-auto","pe-md-5"],[1,"row"],[1,"d-block","mx-auto","image",3,"src"],[1,"row","mt-4"],[1,"p-0"],[1,"col-auto","ps-0","pe-0"],["shape","circle","size","xlarge",1,"avatar","me-2",3,"icon","image"],[1,"col-8","col-xl-auto","p-0"],[1,"row-cols-auto",2,"max-width","max-content"],[1,"fs-5","p-0"],[1,"row-cols-auto","mt-1",2,"max-width","max-content"],["value","Organizaci\xF3n ben\xE9fica","severity","secondary","badgesize","small"],[1,"col-12","col-xl-6","mt-4","mt-xl-0",2,"display","inline-grid"],[1,"row",2,"display","block"],[1,"mb-1",2,"height","max-content"],[2,"display","flex"],[1,"row","align-items-start","mt-4","mt-xl-0",2,"display","block"],["for","description",2,"height","max-content"],["name","description",1,"description"],[1,"row","mt-2","align-items-end","mt-2","mt-xl-0"],[1,"title","mb-0"],["icon","pi pi-check",1,"tag",3,"severity","value","rounded"],["icon","pi pi-thumbs-up","fluid","","label","Solicitar producto",1,"mt-4","mt-xl-0",3,"onClick","disabled"],["severity","secondary","badgesize","small",1,"text-capitalize","me-1","mt-1",3,"value"],[1,"flex","flex-col","items-center","w-full","gap-4","border-b","border-surface-200","dark:border-surface-700"],["maxlength","255","rows","4","cols","50","pTextarea","","placeholder","Escribe tu mensaje aqu\xED...",3,"ngModelChange","ngModel"]],template:function(r,e){if(r&1){let d=D();i(0,"div",1)(1,"div",2)(2,"h1",3)(3,"i",4),b("click",function(){return g(d),v(e.goBack())}),t(),s(4," Detalles del producto "),t(),i(5,"div",5)(6,"div",6)(7,"div",7)(8,"div",8),m(9,"img",9),t(),i(10,"div",10)(11,"h2",11),s(12,"Informaci\xF3n del donante"),t()(),i(13,"div",8)(14,"div",12),m(15,"p-avatar",13),t(),i(16,"div",14)(17,"div",15)(18,"span",16),s(19),t()(),i(20,"div",17),C(21,ne,2,0)(22,se,1,0,"p-badge",18),t()()()(),i(23,"div",19)(24,"div",20)(25,"h1",21),s(26),t(),i(27,"div",22)(28,"span"),s(29,"Categor\xEDa:\xA0"),t(),i(30,"span"),s(31),t()()(),i(32,"div",23)(33,"label",24),s(34,"Descripci\xF3n:"),t(),i(35,"p",25),s(36),t()(),i(37,"div",26)(38,"h3",27),s(39,"Estado"),t(),m(40,"p-tag",28),i(41,"p-button",29),b("onClick",function(){return g(d),v(e.openRquest())}),t()()()()()()(),i(42,"p-confirmdialog"),P(43,le,6,3,"ng-template",null,0,q),t()}r&2&&(n(9),u("src",e.productData==null?null:e.productData.urlImagen,x),n(6),u("icon",e.donorData!=null&&e.donorData.urlImagen?"":"pi pi-user fs-4")("image",e.donorData!=null&&e.donorData.urlImagen?e.donorData==null?null:e.donorData.urlImagen:""),n(4),p(e.donorData==null?null:e.donorData.alias),n(2),E((e.donorData==null?null:e.donorData.roles.length)>0?21:22),n(5),p(e.productData==null?null:e.productData.nombre),n(5),_(" ",e.productData==null?null:e.productData.categoria.nombre),n(5),p(e.productData==null?null:e.productData.descripcion),n(4),u("severity",e.getSeverity(e.productData==null?null:e.productData.estado))("value",e.productData==null?null:e.productData.estado.replace("_"," "))("rounded",!0),n(),u("disabled","RESERVADO|ENTREGADO".includes(e.productData==null?null:e.productData.estado)||e.searchRequest()||(e.productData==null?null:e.productData.usuario.id)==(e.logedUser==null?null:e.logedUser.id)))},dependencies:[W,H,F,K,te,N,z,j,A,L,B,Y,X],styles:["@media (max-width: 575px){.main-container[_ngcontent-%COMP%]{padding-top:2vh!important}.product-content[_ngcontent-%COMP%]{width:100%!important}}.product-content[_ngcontent-%COMP%]{background:var(--p-content-background);box-shadow:0 2px 6px #00190f1a;border-radius:var(--p-border-radius-xl)}#card[_ngcontent-%COMP%]{background-color:var(--p-content-background)}.image[_ngcontent-%COMP%]{max-height:45vh;height:45vh;width:40vh;object-fit:cover;padding:0;border-radius:var(--p-border-radius-xl)}.description[_ngcontent-%COMP%]{height:15vh;max-height:15vh;overflow:auto}.title[_ngcontent-%COMP%], .main-card[_ngcontent-%COMP%]{max-width:max-content}.tag[_ngcontent-%COMP%]{max-width:max-content;max-height:fit-content}.go-back-buttom[_ngcontent-%COMP%]{cursor:pointer}.main-container[_ngcontent-%COMP%]{padding:4vh 4vw;height:max-content}"]})};export{re as ProductDetail};
