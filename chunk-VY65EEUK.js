import{a as de}from"./chunk-CB6J6BBJ.js";import{a as ce,b as pe}from"./chunk-RSHBZTWH.js";import{a as Z,b as ee}from"./chunk-W5KZAQGJ.js";import"./chunk-2XCJVA3X.js";import"./chunk-PDTI4AWR.js";import"./chunk-6A5XL65D.js";import{a as me,b as se}from"./chunk-T4MU4AB4.js";import{a as re,b as ae}from"./chunk-TDFDGLCL.js";import{a as le}from"./chunk-DW6VR7TT.js";import{a as E,b as te,c as ie}from"./chunk-ZXYQCOEA.js";import"./chunk-QD7ZASQF.js";import"./chunk-BPTCD5M7.js";import{a as K,b as W}from"./chunk-3DND4RW6.js";import"./chunk-7QJ2EETJ.js";import"./chunk-EL5SIMWJ.js";import"./chunk-FKOEVO4B.js";import{a as X,b as Y}from"./chunk-M7F2YWVM.js";import{a as oe}from"./chunk-D5OLY3RM.js";import{C as H,D as J,b as z,c as f,e as A,f as L,g as $,h as v,k as B,l as G,n as Q,o as q}from"./chunk-CQCVERZP.js";import"./chunk-4G3JCKZK.js";import"./chunk-4O3FVBGX.js";import{D as ne,b as N,l as O,x as R}from"./chunk-QOJUQ6XD.js";import{$b as k,Bb as y,Cb as _,Db as F,Ec as x,Fb as D,Gb as T,Hb as c,Ib as r,Jb as o,Kb as s,Rb as C,Va as b,Wb as h,Xb as p,Za as m,a as P,ac as j,bc as M,ea as d,g as I,ja as g,jb as S,jc as l,ka as u,lc as V,pb as U}from"./chunk-A4JG42N6.js";function he(i,n){}function fe(i,n){if(i&1&&(r(0,"div",36),s(1,"img",37),o()),i&2){let e=p(2);m(),c("src",e.imagenUrl,b)}}function ye(i,n){if(i&1&&(r(0,"div",36),s(1,"img",38),o()),i&2){let e=p(2);m(),c("src",e.originalProyectImage,b)}}function _e(i,n){if(i&1&&(r(0,"div",36),s(1,"img",39),o()),i&2){let e=p().$implicit;m(),c("alt",e.name)("src",e.objectURL,b)}}function ve(i,n){if(i&1&&y(0,_e,2,2,"div",36),i&2){let e=n.$index;_(e==0?0:-1)}}function be(i,n){if(i&1&&D(0,ve,1,1,null,null,F),i&2){let e=p().$implicit;T(e)}}function Ce(i,n){if(i&1&&y(0,fe,2,1,"div",36)(1,ye,2,1,"div",36)(2,be,2,0),i&2){let e=n.$implicit,t=p();_(t.imagenUrl?0:t.imagenUrl&&!t.imagen?1:e.length>0?2:-1)}}function xe(i,n){i&1&&(r(0,"div",40),s(1,"i",41),r(2,"p",42),l(3,"Carga una imagen"),o()())}function Ee(i,n){if(i&1&&y(0,xe,4,0,"div",40),i&2){let e=p();_(!e.imagenUrl&&!e.imagen?0:-1)}}function we(i,n){if(i&1){let e=C();r(0,"p-button",43),h("onClick",function(){g(e);let a=p();return u(a.choose())}),o()}}function Pe(i,n){if(i&1){let e=C();r(0,"p-button",44),h("onClick",function(){g(e);let a=p();return u(a.clearImage())}),o()}}function Ie(i,n){i&1&&s(0,"i",35)}var ge=class i{fileUpload;router=d(R);proyectService=d(de);imageService=d(ie);loginService=d(oe);permissionsService=d(le);toasts=d(ne);location=d(N);id;loggedUser;originalData;proyectForm;setUploading=!1;imagenUrl=null;imagen=null;originalProyectImage=null;changeImage=!1;minDate=new Date;constructor(){this.proyectForm=new $({nombre:new v("",[f.required,f.maxLength(255)]),descripcion:new v("",[f.required,f.maxLength(255)]),fechaFin:new v("",[f.required]),objetivo:new v(void 0,[f.required])})}ngOnInit(){if(this.minDate=new Date,this.minDate.setDate(this.minDate.getDate()+1),this.loginService.getLoggedUser().subscribe(n=>{if(this.loggedUser=n,!this.loggedUser){this.router.navigate(["/login"]);return}if(!this.permissionsService.canAccessRoute(n,this.router.url)){this.router.navigate(["/principal"]);return}}),this.id=this.proyectService.getIdProyect(),!this.id){this.router.navigate(["/principal"]);return}this.loadProyectData()}reverseDate(n){let e=n.includes("/"),t=n.split(e?"/":"-");return`${t[2]}-${t[1]}-${Number(t[0])+1}`}loadProyectData(){this.proyectService.getProyect(this.id).subscribe({next:n=>{if(this.originalData=n,this.proyectForm.setValue({nombre:this.originalData.nombre,descripcion:this.originalData.descripcion,fechaFin:this.originalData.fechaFin.replaceAll("-","/"),objetivo:this.originalData.objetivo}),this.originalData.imagenes&&this.originalData.imagenes.length>0){let e=this.originalData.imagenes[0];typeof e=="string"?this.imagenUrl=e:e&&e.url?this.imagenUrl=e.url:e&&e.urlImagen?this.imagenUrl=e.urlImagen:this.imagenUrl=null,this.originalProyectImage=this.imagenUrl,this.changeImage=!1}},error:n=>{console.error("Error obteniendo proyecto:",n),this.toasts.showToast({severity:"error",summary:"Error al obtener proyecto",detail:"No pudimos obtener el proyecto, intente nuevamente..."}),this.goBack()}})}goBack(){this.location.back()}choose(){this.fileUpload.choose()}setImage(n){if(!"|image/jpg|image/jpeg|image/png|".includes(n.files[0].type)){this.showImageError();return}this.imagen=n.files[0],this.changeImage=!0;let e=new FileReader;e.onload=()=>{this.imagenUrl=e.result},e.readAsDataURL(this.imagen)}showImageError(){this.toasts.showToast({severity:"error",summary:"Formato de imagen inv\xE1lido",detail:"Formatos admitidos: jpg, png o jpeg"})}clearImage(){this.fileUpload.clear(),this.imagen=null,this.imagenUrl=null,this.changeImage=!0}onSubmit(){return I(this,null,function*(){if(this.setUploading=!0,this.proyectForm.invalid){this.setUploading=!1;return}if(this.changeImage&&this.imagen){let e={image:this.imagen};try{let t=yield this.imageService.uploadImage(e);this.imagenUrl=t.data.url}catch{this.toasts.showToast({severity:"error",summary:"Error al guardar imagen",detail:"No se pudo guardar la imagen correctamente, intente m\xE1s tarde..."}),this.setUploading=!1;return}}else this.changeImage||(this.imagenUrl=this.originalProyectImage);let n=P({idOrganizacion:this.loggedUser.id,imagenes:this.imagenUrl?[this.imagenUrl]:[]},this.proyectForm.value);this.proyectService.editProyect(this.id,n).subscribe({next:()=>{this.toasts.showToast({severity:"success",summary:"Proyecto editado!",detail:"Se edit\xF3 el proyecto con \xE9xito"}),this.goBack(),this.setUploading=!1},error:()=>{this.toasts.showToast({severity:"error",summary:"Error al editar proyecto",detail:"No pudimos editar tu proyecto, intente nuevamente..."}),this.setUploading=!1}})})}cancel(){this.originalData&&(this.proyectForm.setValue({nombre:this.originalData.nombre,descripcion:this.originalData.descripcion,fechaFin:this.originalData.fechaFin.replaceAll("-","/"),objetivo:this.originalData.objetivo}),this.changeImage=!1,this.imagenUrl=this.originalProyectImage,this.imagen=null,this.fileUpload&&this.fileUpload.clear(),this.proyectForm.markAsPristine())}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=S({type:i,selectors:[["app-edit-proyect"]],viewQuery:function(e,t){if(e&1&&k(E,5),e&2){let a;j(a=M())&&(t.fileUpload=a.first)}},decls:59,vars:11,consts:[["header",""],["content",""],["empty",""],[1,"main-container","container-fluid"],[1,"col-auto","justify-content-center","align-content-center","h-100"],[1,"d-flex","my-2","align-items-center","mb-4"],[1,"pi","pi-chevron-left","me-3","go-back-buttom",3,"click"],[1,"p-fluid","p-4",3,"formGroup"],[1,"row","w-100"],[1,"col-12","col-sm-12","col-md-12","col-lg-4","text-center"],["for","inputImage"],[2,"color","red"],["name","inputImage","accept",".jpg,.png,.jpeg","maxFileSize","1000000","styleClass","mt-2",3,"onSelect","multiple"],["styleClass","mt-2","label","Elegir imagen","icon","pi pi-upload"],["styleClass","mt-2","label","Quitar imagen","icon","pi pi-times","severity","danger"],[1,"col-12","col-sm-12","col-md-12","col-lg-8","mt-4","mt-lg-0"],[1,"row-gap-0"],["for","title"],["name","title","placeholder","Ej: Fondos para...","pInputText","","type","text","fluid","","formControlName","nombre",1,"mt-2"],[1,"mt-4","row-gap-0"],["for","description"],["name","description","placeholder","Describe el motivo del proyecto detalladamente...","formControlName","descripcion","rows","5","cols","30","pTextarea","","fluid","",1,"mt-2"],[1,"mt-4","row-gap-0","row"],[1,"col-12","col-sm-12","col-md-6","col-lg-6","mt-4","mt-md-0","mt-lg-0"],["for","fechaFinalizacion"],["id","fechaFinalizacion","formControlName","fechaFin","fluid","","inputId","icondisplay","appendTo","body","dateFormat","dd/mm/yy","placeholder","Selecciona la fecha de finalizaci\xF3n",1,"mt-1",3,"iconDisplay","showIcon","minDate"],["for","objetivo"],["fluid","","formControlName","objetivo","inputId","currency-ars","mode","currency","currency","ARS","locale","es-AR","placeholder","$ 10.000,00",1,"mt-1",3,"min"],["for","title",1,"p-0"],[1,"d-flex","row-gap-0","py-2","align-content-center"],["name","","icon","pi pi-check","severity","success","value","Activo","fluid","",1,"w-100"],[1,"row","w-100","justify-content-end"],[1,"col-auto","mt-4"],["label","Cancelar","severity","secondary",1,"me-4",3,"onClick","disabled"],[3,"onClick","disabled"],[1,"pi","pi-spin","pi-spinner"],[1,"flex","items-center","justify-center","flex-col"],["role","presentation","alt","Imagen cargada",3,"src"],["role","presentation","alt","Imagen actual",3,"src"],["role","presentation",3,"alt","src"],[1,"justify-content-center","align-items-center","empty-content","no-image"],[1,"pi","pi-file-arrow-up",2,"font-size","2.5rem"],[1,"mt-6","mb-0"],["styleClass","mt-2","label","Elegir imagen","icon","pi pi-upload",3,"onClick"],["styleClass","mt-2","label","Quitar imagen","icon","pi pi-times","severity","danger",3,"onClick"]],template:function(e,t){if(e&1){let a=C();r(0,"div",3)(1,"div",4)(2,"h1",5)(3,"i",6),h("click",function(){return g(a),u(t.goBack())}),o(),l(4," Editar Proyecto "),o(),r(5,"p-card")(6,"div",7)(7,"div",8)(8,"div",9)(9,"label",10),l(10,"Imagen del proyecto"),r(11,"span",11),l(12,"\u2002*"),o()(),r(13,"p-fileupload",12),h("onSelect",function(ue){return g(a),u(t.setImage(ue))}),U(14,he,0,0,"ng-template",null,0,x)(16,Ce,3,1,"ng-template",null,1,x)(18,Ee,1,1,"ng-template",null,2,x),o(),y(20,we,1,0,"p-button",13)(21,Pe,1,0,"p-button",14),o(),r(22,"div",15)(23,"div",16)(24,"label",17),l(25,"T\xEDtulo del proyecto"),r(26,"span",11),l(27,"\u2002*"),o()(),s(28,"input",18),o(),r(29,"div",19)(30,"label",20),l(31,"Descripci\xF3n"),r(32,"span",11),l(33,"\u2002*"),o(),r(34,"span"),l(35),o()(),s(36,"textarea",21),o(),r(37,"div",22)(38,"div",23)(39,"label",24),l(40,"Fecha finalizaci\xF3n"),o(),s(41,"p-datepicker",25),o(),r(42,"div",23)(43,"label",26),l(44,"Monto objetivo a recaudar"),o(),s(45,"p-inputnumber",27),o()(),r(46,"div",19)(47,"div",23)(48,"div",16)(49,"label",28),l(50,"Estado"),o()(),r(51,"div",29),s(52,"p-tag",30),o()()()()(),r(53,"div",31)(54,"div",32)(55,"p-button",33),h("onClick",function(){return g(a),u(t.cancel())}),o(),r(56,"p-button",34),h("onClick",function(){return g(a),u(t.onSubmit())}),l(57," Guardar cambios"),y(58,Ie,1,0,"i",35),o()()()()()()()}if(e&2){let a;m(6),c("formGroup",t.proyectForm),m(7),c("multiple",!1),m(7),_(!t.imagen&&!t.imagenUrl?20:21),m(15),V("\u2002(",((a=t.proyectForm.get("descripcion"))==null?null:a.value.length)??0,"/255)"),m(6),c("iconDisplay","input")("showIcon",!0)("minDate",t.minDate),m(4),c("min",0),m(10),c("disabled",t.proyectForm.pristine&&!t.changeImage||t.setUploading),m(),c("disabled",t.proyectForm.invalid||!t.imagen&&!t.imagenUrl||t.setUploading||!t.changeImage),m(2),_(t.setUploading?58:-1)}},dependencies:[O,Q,z,A,L,q,B,G,W,K,te,E,J,H,ae,re,ee,Z,pe,ce,Y,X,se,me],styles:["@media (max-width: 412px){.profile-data[_ngcontent-%COMP%]{justify-content:center}}@media (max-width: 575px){.main-container[_ngcontent-%COMP%]{padding-top:2vh!important}}img[_ngcontent-%COMP%]{max-height:30vh;height:30vh;width:auto;max-width:100%;border-radius:var(--p-fileupload-border-radius);object-fit:cover}.no-image[_ngcontent-%COMP%]{min-height:30vh}.empty-content[_ngcontent-%COMP%]{height:21vh;align-content:center}textarea[_ngcontent-%COMP%]{resize:vertical;min-height:10vh;max-height:25vh}  .p-fileupload-header{display:none!important}  .p-fileupload-content{padding:1.25rem}.go-back-buttom[_ngcontent-%COMP%]{cursor:pointer}.main-container[_ngcontent-%COMP%]{padding:4vh 4vw;height:max-content}"]})};export{ge as EditProyect};
