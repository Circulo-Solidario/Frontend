import{a as me,b as ue}from"./chunk-THLGVQOA.js";import{a as ge,b as ye}from"./chunk-JQLK4AHE.js";import{a as fe}from"./chunk-CB6J6BBJ.js";import{a as se,b as pe}from"./chunk-RSHBZTWH.js";import"./chunk-DVFEINU7.js";import{a as ie,b as ne}from"./chunk-CYTZBTDE.js";import{a as oe,b as re,c as ae}from"./chunk-N5XN2V3Z.js";import{a as le,b as ce}from"./chunk-TDFDGLCL.js";import{a as de}from"./chunk-DW6VR7TT.js";import"./chunk-7QJ2EETJ.js";import"./chunk-FKOEVO4B.js";import"./chunk-M7F2YWVM.js";import{a as te}from"./chunk-D5OLY3RM.js";import{C as J,D as Q,e as K,i as H,n as W,u as Z,v as $}from"./chunk-CQCVERZP.js";import{ba as E}from"./chunk-4G3JCKZK.js";import"./chunk-4O3FVBGX.js";import{C as Y,D as ee,j as N,l as G,s as U,v as X,x as q}from"./chunk-QOJUQ6XD.js";import{$ as A,Bb as O,Cb as T,Dc as D,Ec as I,Hb as p,Ib as o,Jb as n,Kb as d,Rb as w,Va as x,Wb as y,Xb as R,Za as l,d as we,e as Pe,ea as c,g as s,ja as u,jb as k,jc as a,ka as g,kc as f,lc as j,mc as z,nc as F,oc as L,pb as S,pc as B,qc as V,z as C,zc as P}from"./chunk-A4JG42N6.js";var be=we(h=>{"use strict";Object.defineProperty(h,"__esModule",{value:!0});h.loadMercadoPago=void 0;var he="https://sdk.mercadopago.com/js/v2",De=/^https:\/\/sdk\.mercadopago\.com\/js\/v2\/?(\?.*)?$/,ve="MercadoPago has already been initialized in your window, please remove the duplicate import",Ie="MercadoPago.js not available",Ee="Failed to load MercadoPago.js",Me=()=>{for(var r=document.querySelectorAll(`script[src^="${he}"`),t=0;t<r.length;t++){var i=r[t];if(De.test(i.src))return i}return null},Ce=()=>{let r=document.createElement("script");r.src=he;let t=document.head||document.body;if(!t)throw new Error("Expected document.body or document.head not to be null. MercadoPago requires a <body> or a <head> element, please add on your project.");return t.appendChild(r),r},v=null,Ae=()=>(v!==null||(v=new Promise((r,t)=>{if(typeof window>"u"){r(null);return}if(window.MercadoPago){console.warn(ve),r(window.MercadoPago);return}try{let i=Me();i?console.warn(ve):i||(i=Ce()),i.addEventListener("load",()=>{window.MercadoPago?r(window.MercadoPago):t(new Error(Ie))}),i.addEventListener("error",()=>{t(new Error(Ee))})}catch(i){t(i);return}})),v);h.loadMercadoPago=Ae});var _e=Pe(be());var b=class r{http=c(U);apiUrl=`${Y.apiUrl}/donaciones`;mpKey="APP_USR-494bc242-a343-4b9f-806b-4ab567744ec3";createPreference(t,i){return s(this,null,function*(){return(yield C(this.http.post(this.apiUrl,{proyectoId:t,monto:i}))).preferenceId})}initMercadoPago(){return s(this,null,function*(){return yield(0,_e.loadMercadoPago)(),new window.MercadoPago(this.mpKey,{locale:"es-AR"})})}createPayButton(t){return s(this,null,function*(){yield(yield this.initMercadoPago()).bricks().create("wallet","wallet_container",{initialization:{preferenceId:t},customization:{texts:{valueProp:"smart_option"}}})})}static \u0275fac=function(i){return new(i||r)};static \u0275prov=A({token:r,factory:r.\u0275fac,providedIn:"root"})};function ke(r,t){r&1&&(o(0,"div"),d(1,"p-progress-spinner",36),n())}function Oe(r,t){if(r&1&&(o(0,"div",34),O(1,ke,2,0,"div"),d(2,"div",35),n()),r&2){let i=R();l(),T(i.loading?1:-1)}}function Te(r,t){if(r&1){let i=w();o(0,"div",37)(1,"div",38),d(2,"i",39),n(),o(3,"div",40)(4,"span",41),a(5,"Donaci\xF3n realizada!"),n(),o(6,"p",42),a(7,"Hemos realizado el dep\xF3sito de la donaci\xF3n a la organizaci\xF3n, gracias por tu ayuda!"),n()(),o(8,"div",43)(9,"p-button",44),y("click",function(){let m=u(i).onReject;return g(m())}),n()()()}}var Se=class r{router=c(q);route=c(X);toasts=c(ee);loginService=c(te);permissionsService=c(de);proyectService=c(fe);donationService=c(b);confirmationService=c(E);id;filters;proyectData;logedUser;loading=!1;amount;ngOnInit(){this.loginService.getLoggedUser().subscribe(e=>{if(this.logedUser=e,e==null){this.router.navigate(["/login"]);return}if(!this.permissionsService.canAccessRoute(e,this.router.url)){this.router.navigate(["/principal"]);return}});let i=this.router.currentNavigation()?.extras?.state||history.state;i?.id&&this.proyectService.saveIdProyect(i?.id),this.id=i?.id||localStorage.getItem("proyectId"),this.filters=i?.filters,this.getProyectData(),this.route.queryParams.subscribe(e=>{e.collection_status&&e.status&&e.payment_id&&this.updatefoundig({collection_status:e.collection_status,status:e.status,payment_id:e.payment_id})})}updatefoundig(t){let i=localStorage.getItem("payment_id")??null,e=localStorage.getItem("donation-amount")??null;e&&(t.collection_status&&t.status)=="approved"&&t.payment_id!=i&&this.proyectService.updateFounding(this.id,e,this.logedUser.id).subscribe({next:()=>{this.confirmationService.confirm({key:"approvedPay",rejectButtonProps:{label:"Aceptar",variant:"outlined",size:"small"},acceptVisible:!1,reject:()=>{}}),localStorage.setItem("payment_id",t.payment_id),this.getProyectData()}})}donate(){return s(this,null,function*(){this.confirmationService.confirm({key:"donation",header:"Realizar pago a organizaci\xF3n",rejectButtonProps:{label:"Cancelar",icon:"pi pi-times",variant:"outlined",size:"small"},acceptVisible:!1,reject:()=>{}}),this.loading=!0;let t=yield this.donationService.createPreference(this.proyectData?.id,this.amount);yield this.donationService.createPayButton(t),localStorage.setItem("donation-amount",this.amount),this.loading=!1})}getProyectData(){this.proyectService.getProyect(this.id).subscribe({next:t=>{this.proyectData=t},error:()=>{this.toasts.showToast({severity:"error",summary:"Error al obtener detalles del proyecto",detail:"Error al obtener detalles del proyecto, intente nuevamente..."})}})}getSeverity(t){switch(t){case"ACTIVO":return"success";case"CANCELADO":return"danger";case"FINALIZADO_EXITOSO":return"warn";case"FINALIZADO_NO_EXITOSO":return"danger";default:return"success"}}goBack(){this.router.navigate(["/principal/proyectos"],{queryParams:{nombre:this.filters?.nombre??void 0,organizacion:this.filters?.organizacion??void 0,estado:this.filters?.estado??void 0}})}static \u0275fac=function(i){return new(i||r)};static \u0275cmp=k({type:r,selectors:[["app-proyect-detail"]],features:[V([E])],decls:56,vars:26,consts:[["message",""],["headless",""],[1,"main-container","container-fluid","pt-3"],[1,"col-auto","justify-content-center","align-content-center","h-100"],[1,"d-flex","my-2","align-items-center","mb-4"],[1,"pi","pi-chevron-left","me-3","go-back-buttom",3,"click"],[1,"container-fluid"],[1,"row","m-auto","justify-content-center","w-75","row-cols-2","p-4","product-content"],[1,"col-auto","pe-md-5"],[1,"row"],[1,"d-block","mx-auto","image",3,"src"],[1,"row","mt-4"],[1,"p-0"],[1,"col-auto","ps-0","pe-0"],["shape","circle","size","xlarge",1,"avatar","me-2",3,"icon","image"],[1,"col-8","col-xl-auto","p-0"],[1,"row-cols-auto",2,"max-width","max-content"],[1,"fs-5","p-0"],[1,"row-cols-auto","mt-1",2,"max-width","max-content"],["value","Organizaci\xF3n ben\xE9fica","severity","secondary","badgesize","small"],[1,"col-12","col-xl-6","mt-4","mt-xl-0",2,"display","inline-grid"],[1,"row",2,"display","block"],[1,"mb-1",2,"height","max-content"],[2,"display","block"],[1,"row","align-items-start","mt-4","mt-xl-0",2,"display","block"],["for","description",2,"height","max-content"],["name","description",1,"description"],[1,"row","mt-2","align-items-end","mt-2","mt-xl-0","donor-buttons"],[1,"title","mb-0"],["icon","pi pi-check",1,"tag",3,"severity","value","rounded"],["fluid","","inputId","currency-ars","mode","currency","currency","ARS","locale","es-AR","placeholder","$ 100,00",1,"mt-1",3,"ngModelChange","disabled","min","ngModel"],["label","Donar",3,"onClick","disabled"],["key","donation"],["key","approvedPay"],[1,"d-flex","flex-column","justify-content-center","align-items-center","w-100",2,"overflow","hidden"],["id","wallet_container"],["ariaLabel","loading"],[1,"d-flex","flex-column","align-items-center","p-4","rounded","position-relative"],[1,"rounded-circle","d-flex","justify-content-center","align-items-center",2,"height","96px","width","96px","position","absolute","top","-48px","background-color","var(--p-menu-background)"],[1,"pi","pi-check","fs-1"],[1,"mt-2","pt-4","text-center"],[1,"fw-bold","fs-3","d-block","mb-2"],[1,"mb-0"],[1,"d-flex","justify-content-center","align-items-center","gap-2","mt-4"],["label","Aceptar","fluid","","outlined","true",3,"click"]],template:function(i,e){if(i&1){let m=w();o(0,"div",2)(1,"div",3)(2,"h1",4)(3,"i",5),y("click",function(){return u(m),g(e.goBack())}),n(),a(4," Detalles del proyecto "),n(),o(5,"div",6)(6,"div",7)(7,"div",8)(8,"div",9),d(9,"img",10),n(),o(10,"div",11)(11,"h2",12),a(12,"Informaci\xF3n de la organizacion"),n()(),o(13,"div",9)(14,"div",13),d(15,"p-avatar",14),n(),o(16,"div",15)(17,"div",16)(18,"span",17),a(19),n()(),o(20,"div",18),d(21,"p-badge",19),n()()()(),o(22,"div",20)(23,"div",21)(24,"h1",22),a(25),n(),o(26,"div",23)(27,"span"),a(28,"Fecha finalizaci\xF3n: "),n(),o(29,"span"),a(30),n(),d(31,"br"),o(32,"span"),a(33,"Recaudado: "),n(),o(34,"span"),a(35),P(36,"currency"),P(37,"currency"),n()()(),o(38,"div",24)(39,"label",25),a(40,"Descripci\xF3n:"),n(),o(41,"p",26),a(42),n()(),o(43,"div",27)(44,"h3",28),a(45,"Estado"),n(),d(46,"p-tag",29),o(47,"p-inputgroup")(48,"p-inputnumber",30),B("ngModelChange",function(_){return u(m),L(e.amount,_)||(e.amount=_),g(_)}),n(),o(49,"p-button",31),y("onClick",function(){return u(m),g(e.donate())}),n()()()()()()()(),o(50,"p-confirmdialog",32),S(51,Oe,3,1,"ng-template",null,0,I),n(),o(53,"p-confirmdialog",33),S(54,Te,10,0,"ng-template",null,1,I),n()}i&2&&(l(9),p("src",e.proyectData==null?null:e.proyectData.imagenes[0].urlImagen,x),l(6),p("icon",e.proyectData!=null&&e.proyectData.organizacion.urlImagen?"":"pi pi-user fs-4")("image",e.proyectData!=null&&e.proyectData.organizacion.urlImagen?e.proyectData==null?null:e.proyectData.organizacion.urlImagen:""),l(4),f(e.proyectData==null?null:e.proyectData.organizacion.alias),l(6),f(e.proyectData==null?null:e.proyectData.nombre),l(5),j(" ",e.proyectData==null?null:e.proyectData.fechaFin.replaceAll("-","/")),l(5),z(" ",D(36,16,e.proyectData==null?null:e.proyectData.recaudado,"ARS","symbol","1.2-2")," / ",D(37,21,e.proyectData==null?null:e.proyectData.objetivo,"ARS","symbol","1.2-2")),l(7),f(e.proyectData==null?null:e.proyectData.descripcion),l(4),p("severity",e.getSeverity(e.proyectData==null?null:e.proyectData.estado))("value",e.proyectData==null?null:e.proyectData.estado.replaceAll("_"," "))("rounded",!0),l(2),p("disabled",!"ACTIVO".includes(e.proyectData==null?null:e.proyectData.estado))("min",0),F("ngModel",e.amount),l(),p("disabled",e.amount<=0||!"ACTIVO".includes(e.proyectData==null?null:e.proyectData.estado)))},dependencies:[Q,J,ne,ie,$,Z,ce,le,G,W,K,H,ye,ge,ue,me,re,oe,ae,pe,se,N],styles:["@media (max-width: 575px){.main-container[_ngcontent-%COMP%]{padding-top:2vh!important}.product-content[_ngcontent-%COMP%]{width:100%!important}}.product-content[_ngcontent-%COMP%]{background:var(--p-content-background);box-shadow:0 2px 6px #00190f1a;border-radius:var(--p-border-radius-xl)}#card[_ngcontent-%COMP%]{background-color:var(--p-content-background)}.image[_ngcontent-%COMP%]{max-height:45vh;height:45vh;width:40vh;object-fit:cover;padding:0;border-radius:var(--p-border-radius-xl)}.description[_ngcontent-%COMP%]{height:15vh;max-height:15vh;overflow:auto}.title[_ngcontent-%COMP%], .main-card[_ngcontent-%COMP%]{max-width:max-content}.tag[_ngcontent-%COMP%]{max-width:max-content;max-height:fit-content}.go-back-buttom[_ngcontent-%COMP%]{cursor:pointer}.main-container[_ngcontent-%COMP%]{padding:4vh 4vw;height:max-content}  .donor-buttons p-inputgroup{align-items:baseline}  .donor-buttons .p-button{height:max-content;border-top-left-radius:0;border-bottom-left-radius:0}"]})};export{Se as ProyectDetail};
